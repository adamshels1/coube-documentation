
**Проект продукта: курьерская доставка**

**Содержание**

[I. Справочники для реализации в БД COUBE
3](#i.-справочники-для-реализации-в-бд-coube)

[II. ТЕХНИЧЕСКИЙ БИЗНЕС-ПРОЦЕСС 6](#ii.-технический-бизнес-процесс)

[Товар поступает на склад 6](#товар-поступает-на-склад)

[TEEZ_PVZ стучится в Coube по API методу "Загрузить маршрутный лист".
6](#teez_pvz-стучится-в-coube-по-api-методу-загрузить-маршрутный-лист.)

[Маршрутный лист (МЛ) могут редактировать все логисты компании
"Курьерская компания"
7](#маршрутный-лист-мл-могут-редактировать-все-логисты-компании-курьерская-компаниятиз)

[Логист назначает курьера на маршрутный лист.
8](#логист-назначает-курьера-на-маршрутный-лист.)

[Логист отправляет маршрутный лист В РАБОТУ.
8](#логист-отправляет-маршрутный-лист-в-работу.)

[Курьер нажимает начать путь 8](#курьер-нажимает-начать-путь)

[Курьер меняет статус заказа 8](#курьер-меняет-статус-заказа)

[Инициативное завершение маршрута курьером
8](#инициативное-завершение-маршрута-курьером)

[Coube стучится в TEEZ_PVZ по методу "Итоги работы по маршрутному листу"
9](#coube-стучится-в-teez_pvz-по-методу-итоги-работы-по-маршрутному-листу)

[Помечание следующих заказов для "проблемного" адреса как требующих
уточнения
10](#пометка-следующих-заказов-для-проблемного-адреса-как-требующих-уточнения)

[Курьер приезжает на склад 10](#курьер-приезжает-на-склад)

[III. АНАЛИТИКА 10](#iii.-аналитика)

[IV. ЛОГИ 11](#iv.-логи)

[Логи событий 11](#логи-событий)

[Логи интеграций (PUB/SUB таблица) 11](#логи-интеграций-pubsub-таблица)

## I. Справочники для реализации в БД COUBE

**Примечание: для всех справочников описана целевая структура данных, но
пока что заполняем только часть полей -- те, которые будут известны.**

**Типы заявок**

+--------------------------------------+-------------------+----------+
| **Перечень типов заявок (енам)**     | **Направление**   | **Прим   |
|                                      |                   | ечание** |
| **Старые отмечены зеленым**          |                   |          |
+======================================+===================+==========+
| -   Заявка на разовую перевозку от   | *От заказчика к   | Наша     |
|     заказчика к исполнителю          | логистической     | обычная  |
|                                      | компании*         | заявка   |
+--------------------------------------+-------------------+----------+
| -   Заявка на регулярную перевозку   | *От заказчика к   | Сыпучка  |
|     (сыпучка) агро                   | логистической     |          |
|                                      | компании*         |          |
+--------------------------------------+-------------------+----------+
| -   Заявка на регулярную перевозку   | *От заказчика к   |          |
|     (сыпучка) инертные материалы     | [логистической    |          |
|                                      | компании как      |          |
|                                      | прода             |          |
|                                      | вцу]{.underline}* |          |
+--------------------------------------+-------------------+----------+
| -   Заявка на разовую перевозку      | *От перевозчика к | Эту      |
|     множества отдельных заказов      | водителю*         | заявку   |
|     (курьерская)                     |                   | создает  |
|                                      |                   | Ку       |
| Особенность этой заявки:             |                   | рьерская |
|                                      |                   | компания |
| -   в ней каждая точка маршрута      |                   | своим    |
|     имеет связанное ID заказа и доп  |                   | в        |
|     поля.                            |                   | одителям |
|                                      |                   | (к       |
| -   В этой заявке могут быть доп.    |                   | урьерам) |
|     Задачи                           |                   |          |
|                                      |                   |          |
| -   Последняя точка такой заявки     |                   |          |
|     пока что всегда должна иметь тип |                   |          |
|     "Курьерский склад"               |                   |          |
+--------------------------------------+-------------------+----------+

**Надроли**

+----------------------------------+-----------------------------------+
| **Перечень надролей (енам)**     | **Примечание**                    |
|                                  |                                   |
| **Старые отмечены зеленым**      |                                   |
+==================================+===================================+
| -   Заказчик в FTL/сыпучке       |                                   |
+----------------------------------+-----------------------------------+
| -   Логистическая компания в     |                                   |
|     FTL/сыпучке                  |                                   |
+----------------------------------+-----------------------------------+
| -   Логистическая компания в     |                                   |
|     курьерской доставке          |                                   |
+----------------------------------+-----------------------------------+
| -   Водитель FTL                 |                                   |
+----------------------------------+-----------------------------------+
| -   Водитель в перевозке сыпучих |                                   |
|     грузов                       |                                   |
+----------------------------------+-----------------------------------+
| -   Курьер                       | Подтип водителя, который имеет    |
|                                  | доступ к заявкам другого типа     |
|                                  | (курьерская заявка). Под          |
|                                  | курьерские заявки слегка иначе    |
|                                  | работает приложение.              |
+----------------------------------+-----------------------------------+

**Геозона**

  -----------------------------------------------------------------------
  **Поле**                       **Тип**
  ------------------------------ ----------------------------------------
  Название зоны                  Текст

  Массив координат, формирующих  
  периметр                       
  -----------------------------------------------------------------------

[Как заполняется]{.underline}: Хардкодом.

Данные для этого справочника Teez должен передать в некоем виде, который
мы сможем распознать и затем сделать заливку в нашу БД.

**Подразделение организации Примечание: пока не делаем, но держим в
уме**

  -----------------------------------------------------------------------
  **Поле**                       **Тип**
  ------------------------------ ----------------------------------------
  id                             

  Организация, к которой         
  относится                      

  Название подразделения         

  Список геозон, за которые      Список айди
  отвечает                       
  -----------------------------------------------------------------------

**Курьер (подтип водителя)**

+------------------------------+---------------------------------------+
| **Поле**                     | **Тип**                               |
+==============================+=======================================+
| Внутренний id пользователя в |                                       |
| COUBE                        |                                       |
+------------------------------+---------------------------------------+
| Интеграционные данные:       |                                       |
| массив                       |                                       |
+------------------------------+---------------------------------------+
| -   Объект массива           |                                       |
+------------------------------+---------------------------------------+
| -   Код внешней системы      | В данном случае только одно значение  |
|     (например "WMS",         | "TEEZ_PVZ"                            |
|     "ПВЗ-система" и т.д.)    |                                       |
+------------------------------+---------------------------------------+
| -   Внешний id пользователя  |                                       |
|     во внешней системе       |                                       |
+------------------------------+---------------------------------------+
| ФИО                          | Текстовое поле                        |
+------------------------------+---------------------------------------+
| Активен                      | Флаг                                  |
+------------------------------+---------------------------------------+
| Номер телефона               | Цифры по маске                        |
+------------------------------+---------------------------------------+
| Емейл                        | Текст по маске                        |
+------------------------------+---------------------------------------+
| Логистическая курьерская     | Перевозчик с типом "курьерская        |
| компания (ПЕРЕВОЗЧИК), к     | компания"                             |
| которой привязан             |                                       |
+------------------------------+---------------------------------------+
| Подразделение компании       |                                       |
+------------------------------+---------------------------------------+
| Текущие геозоны за которые   | Список Id                             |
| отвечает                     |                                       |
+------------------------------+---------------------------------------+
| Примечание                   | Текст                                 |
+------------------------------+---------------------------------------+
| Текущий статус               | В поездке / недоступен по другим      |
|                              | причинам / свободен                   |
+------------------------------+---------------------------------------+

[Как заполняется]{.underline}: вначале можно хардкодом, но на проде
должна быть регистрация курьеров по аналогии с регистрацией водителей.

**~~Задача курьеру~~ Обновление: задачи решили не делать, вместо этого
сделать расширенные маршруты, где все эти доп. задания будут включены**

+------------------------------+---------------------------------------+
| **~~Поле~~**                 | **~~Тип~~**                           |
+==============================+=======================================+
| ~~Id задачи~~                | ~~Должно быть коротким,               |
|                              | человекочитаемым~~                    |
+------------------------------+---------------------------------------+
| ~~Id маршрута (заявки)~~     |                                       |
+------------------------------+---------------------------------------+
| ~~Название задачи~~          |                                       |
+------------------------------+---------------------------------------+
| ~~Автор~~                    |                                       |
+------------------------------+---------------------------------------+
| ~~Id курьера~~               |                                       |
+------------------------------+---------------------------------------+
| ~~Статус задачи~~            | ~~"Получено дополнительное задание"~~ |
|                              |                                       |
|                              | ~~"Курьер принял"~~                   |
|                              |                                       |
|                              | ~~"Курьер отклонил"~~                 |
|                              |                                       |
|                              | ~~"Завершено"~~                       |
+------------------------------+---------------------------------------+
| ~~История дествий по         | ~~Массив "Новый статус -- Дата --     |
| задаче~~                     | Комментарий -- Автор, сменивший       |
|                              | статус"~~                             |
+------------------------------+---------------------------------------+

~~[Как заполняется]{.underline}: из фронтэнда приложения Логиста
исполнителя. Статус изменяется в приложении логиста исполнителя и в
приложении курьера.~~

**Причины, почему заказ не отдан в руки**

+------------------------------+---------------------------------------+
| **Значение в енаме:**        |                                       |
+==============================+=======================================+
| Customer not accessed        | -   Не дозвонился/никто не открыл     |
+------------------------------+---------------------------------------+
| Customer postponed           | -   Клиент попросил не доставлять     |
|                              |     сейчас                            |
+------------------------------+---------------------------------------+

[Как заполняется]{.underline}: хардкодом.

Пока что закладываем эти два значения в енам, затем могут поступить
другие значения от Teez.

**Справочник курьерских складов**

+------------------------------+---------------------------------------+
| **Поле**                     |                                       |
+==============================+=======================================+
| Name                         | Кастомное название склада             |
+------------------------------+---------------------------------------+
| Is pickup point              | ПВЗ                                   |
+------------------------------+---------------------------------------+
| External data                | Объект из двух полей                  |
+------------------------------+---------------------------------------+
| -   Integration system       | Означает внешнюю систему, с которой   |
|                              | выполняется основная интеграция этого |
|                              | справочника.                          |
|                              |                                       |
|                              | На данный момент здесь может быть     |
|                              | только одно значение:                 |
|                              |                                       |
|                              | TEEZ_PVZ                              |
+------------------------------+---------------------------------------+
| -   id                       | External ID склада, который           |
|                              | используется в общении между внешней  |
|                              | системой и COUBE                      |
+------------------------------+---------------------------------------+
| Адрес склада                 |                                       |
+------------------------------+---------------------------------------+
| Координаты склада на карте   |                                       |
+------------------------------+---------------------------------------+

[Как заполняется]{.underline}: пока неизвестно. Желательно получить от
Teez выгрузкуэтого справочника в виде Json-файла, затем руками на нашей
стороне преобразовать его и загрузить в COUBE.

## II. ТЕХНИЧЕСКИЙ БИЗНЕС-ПРОЦЕСС

### Товар поступает на склад

Этот шаг не автоматизируется в COUBE.

### В системе TEEZ_PVZ пользователи формируют маршрутный лист без указания курьера

Объект:

> **{**
>
> **\"waybill\": {** // маршрутный лист (МЛ)
>
> **\"id\": 123,** // идентификатор МЛ из ТизПВЗ
>
> **\"createdDate\": \"2025-04-15T07:39:00.360232Z\"**
>
> **}**
>
> **\"deliveries\": \[**
>
> **{**
>
> **\"externalId\": \"123456\",** // идентификатор МЛ из еще какой-то
> системы Тиза
>
> **\"externalBarcode\": \"123456\",**
>
> **\"teezpostId\": 123,**
>
> **\"companyName\": \"Sending company\",**
>
> **\"receivedFromCustomerDate\": \"2025-03-29\",** // это дата прихода
> товара на склад ПВЗ, нам онапокане интересна
>
> **\"address\": \"г. Астана, ул. Пушкина 1\",** // текстовое поле,
> обратить внимание
>
> **\"status\": {** // эти енамы нам не интересны
>
> **\"id\": 8,**
>
> **\"name\": \"Заказ у курьера\"**
>
> **},**
>
> **\"receiver\": {**
>
> **\"name\": \"Иван Иванов\",** // текстовое поле
>
> **\"phone\": \"+77123456789\"** // текстовое поле
>
> **}**
>
> **}**
>
> **\]**
>
> **}**

Дальше под нас должны добавить следующие поля:

-   В шапку:

    -   Тип (тиз-курьерка или тиз-пост)

-   В массив deliveries:

    -   Тип точки (погрузка или разгрузка)

-   

### TEEZ_PVZ стучится в Coube по API методу "Загрузить маршрутный лист".

Поля запроса:

**ВНИМАНИЕ**: Это таблица на будущее. Пока что надо взять структуру
данных из объекта TEEZ_PVZ и максиально адаптироваться под неё!
Дорабатывать на стороне TEEZ многое вряд ли получится. В будущем сделаем
нормальную структуру данных запроса.

+--------------------------+----+-------------------------------------+
| **Поле**                 | ** | **Тип данных и что значит**         |
|                          | Об |                                     |
|                          | яз |                                     |
|                          | ат |                                     |
|                          | ел |                                     |
|                          | ьн |                                     |
|                          | ос |                                     |
|                          | ть |                                     |
|                          | ** |                                     |
+==========================+====+=====================================+
| Courier org id           |    | Пока что мы сами хардкодом          |
|                          |    | проставляем компанию Тиз            |
+--------------------------+----+-------------------------------------+
| target delivery day      | \* | Дата.                               |
|                          |    |                                     |
|                          |    | В первой версии, всегда должна быть |
|                          |    | равна текущему дню.                 |
|                          |    |                                     |
|                          |    | Бэкенд Coube должен проводить       |
|                          |    | валидацию на это условие.           |
+--------------------------+----+-------------------------------------+
| Source system            | \* | Здесь всегда хардкодом передаем     |
|                          |    | "TEEZ_PVZ"                          |
+--------------------------+----+-------------------------------------+
| pvz route id             | \* | Идентификатор маршрутного листа в   |
|                          |    | TEEZ_PVZ                            |
+--------------------------+----+-------------------------------------+
| Route points             | \* | Массив объектов типа Точка Маршрута |
+--------------------------+----+-------------------------------------+
| -   \[Route point\]      | \* | Объект Точка Маршрута               |
+--------------------------+----+-------------------------------------+
| -   point number         | \* | Номер точки в маршрута, должен быть |
|                          |    | задан в явном виде.                 |
|                          |    |                                     |
|                          |    | В МВП наверное не будет, задаем     |
|                          |    | сами                                |
+--------------------------+----+-------------------------------------+
| -   address              |    | Текстовое поле.                     |
|                          |    |                                     |
|                          |    | Обязательно для заполонения, если   |
|                          |    | точка не является курьерским        |
|                          |    | складом.                            |
+--------------------------+----+-------------------------------------+
| -   courier warehouse id |    | Обязательно для заполнения, если    |
|                          |    | точка является курьерским складом.  |
|                          |    |                                     |
|                          |    | Идентификатор передается тот,       |
|                          |    | который применяется дляинтеграции   |
|                          |    | конкретной этой source_system с     |
|                          |    | COUBE.                              |
+--------------------------+----+-------------------------------------+
| -   order info           | \* | Объект                              |
+--------------------------+----+-------------------------------------+
| -   is order for legal   | \* | Флаг, означает, что заказ           |
|     entity               |    | доставляется на юрлицо              |
+--------------------------+----+-------------------------------------+
| -   Target delivery time | \* | \[часы, минуты внутри дня; можно    |
|     from                 |    | сделать отдельным полем, поскольку  |
|                          |    | не имеют такого важного значения    |
|                          |    | как target delivery day\]           |
+--------------------------+----+-------------------------------------+
| -   \+ target delivery   | \* |                                     |
|     time to \[часы,      |    |                                     |
|     минуты внутри дня\]  |    |                                     |
+--------------------------+----+-------------------------------------+
| -   Delivery             | \* | Enum:                               |
|     verification type    |    |                                     |
|                          |    | -   sms                             |
|                          |    |                                     |
|                          |    | -   not_required                    |
|                          |    |                                     |
|                          |    | Тип подтверждения доставки.         |
|                          |    |                                     |
|                          |    | На данный момент специальная        |
|                          |    | хардкодная валидация: если заказ на |
|                          |    | юрлицо, то обязательно должно быть  |
|                          |    | запрошено смс-подтверждение.        |
+--------------------------+----+-------------------------------------+

Дополнительные валидации:

-   В маршрутном листе последняя точка маршрута должна являться складом
    Teez. Если ее нет, она автоматически добавляется. В МВП наверное ее
    никогда не будет,нам надо добавлять автоматически

-   Не может быть больше одной точки с одинаковым номером точки

При записи маршрутного листа в БД, Coube дополнительно записывает в
каждый маршрутный лист следующие данные:

-   org id = TEEZ

И при успешной, и при неуспешной попытке интеграции, Coube записывает
лог событий (тип события = попытка создания маршрутного листа).

### Маршрутный лист (МЛ) могут редактировать все логисты компании "Курьерская компания"(Тиз)

Маршрутный лист (МЛ) пока что могут редактировать все логисты компании
org id.

**Важно**: При ручном редактировании и запуске в работу Маршрутного
листа, которая пришла по интеграции из TEEZ_PVZ, должны сработать все те
же валидации, которые сейчас работают в COUBE при ручном создании
заявок!

Аналогично должны быть доступны функции ручного выбора адреса на карте.

Аналогично, если адрес не найден, запустить заявку в работу будет
невозможно.

При редактировании МЛ, логист может

\- добавлять точки

\- удалять точки

\- изменять адрес точки

\- менять последовательность точек

Каждый факт изменения маршрутного листа фиксируется в БД.

Кроме того, все добавленнные/ измененные/удаленные точки отдельно
помечаются в БД и доступны для истории. При изменении адреса
дополнительно надо хранить и предыдущий, и новый адрес (для истории).
**Предлагается использовать для этого ту же архитектуру, которая
реализована для смены маршрута в обычной заявке (или сделать
аналогично)**.

При изменении порядковых номеров -- в БД фиксируем только сам факт
изменения порядковых номеров, но **не** фиксируем полную историю того,
какая точка под каким порядковым номером была и стала.

### Логист назначает курьера на маршрутный лист.

Курьер получает уведомление об этом.

При этом логист может еще не отправить маршрутный лист в работу.

Курьер может видеть все назначенные на него маршрутные листы.

Но в работе у курьера может быть только один из них.

### 

### Логист отправляет маршрутный лист В РАБОТУ.

Курьеру отправляется заявка в приложении.

Он может принять или отклонить ее.

### Курьер нажимает начать путь

Всё как обычно, ему отображается первая точка маршрута.

### Курьер меняет статус заказа

При приезде на точку (а может быть возможно и не доезжая -- **Тофику
решить на этапе дизайна**), курьер нажимает одну из опций, изменяющих
статус точки (заказа):

  -----------------------------------------------------------------------
  "**Приехал, отдал заказ**" **+ код из СМС клиента** (обязательно если
  это запрошено в заказе) + **приложение скана**
  -----------------------------------------------------------------------
  "**Приехал, отдал, но покупатель сделал возврат**"

  "**Приехал, но не отдал заказ**" (две разновидности: "Customer not
  accessed" или "Customer postponed") + **Дата, до которой этот заказ
  нельзя будет отдать** (опционально)
  -----------------------------------------------------------------------

Кроме того, курьер заполняет поле ***Примечание***.

### Инициативное завершение маршрута курьером

Курьер может, не доехав до точки последнего заказа, инициативно нажать
"Я больше не езжу сегодня, возвращаюсь на склад".

### Обычное завершение маршрута курьером

Курьер доезжает до точки последнего заказа.

### 

### Coube стучится в TEEZ_PVZ по методу "Итоги работы по маршрутному листу" 

**(Внимание: сейчас в PVZ возможно нет подходящей api, придется ждать
для этой фичи следующих релизов)**

Когда курьер проходит последнюю точку (не считая точку финального
курьерского склада) или нажимает завершить маршрут -- система подбивает
итоги и выводит отчет ему в мобильному приложение + отправляет
информацию в TEEZ_PVZ.

Coube стучится в TEEZ_PVZ с полями:

Поля запроса:

+--------------+-----+------------------------------------------------+
| **Поле**     | **О | **Тип данных и что значит**                    |
|              | бяз |                                                |
|              | ате |                                                |
|              | льн |                                                |
|              | ост |                                                |
|              | ь** |                                                |
+==============+=====+================================================+
| **Array**    |     |                                                |
+--------------+-----+------------------------------------------------+
| -            |     | Объект                                         |
|    \[Order\] |     |                                                |
+--------------+-----+------------------------------------------------+
| -   Order    | \*  | Тот общий идентификатор, который используется  |
|     external |     | между Кубом и Тизом.                           |
|     id       |     |                                                |
+--------------+-----+------------------------------------------------+
| -   Date     |     |                                                |
+--------------+-----+------------------------------------------------+
| -   Status   |     | Enum:                                          |
|              |     |                                                |
|              |     | \- returned                                    |
|              |     |                                                |
|              |     | \- customer not accessed                       |
|              |     |                                                |
|              |     | \- customer postponed                          |
|              |     |                                                |
|              |     | \- courier cancelled                           |
|              |     |                                                |
|              |     | Return означает, что покупатель увидел груз и  |
|              |     | отдал его обратно курьеру.                     |
|              |     |                                                |
|              |     | courier cancelled означает что курьер в этот   |
|              |     | раз не доехал.                                 |
+--------------+-----+------------------------------------------------+
| -   State    |     | Дата, когда этот статус был присвоен.          |
|     change   |     |                                                |
|     datetime |     |                                                |
+--------------+-----+------------------------------------------------+
| **Array      |     | Массив дополнительных нотификаций (не основная |
| additional   |     | смена статусов, просто информация              |
| evenys**     |     | овспомогательных событиях)                     |
+--------------+-----+------------------------------------------------+
| -            |     |                                                |
|    \[Order\] |     |                                                |
+--------------+-----+------------------------------------------------+
| -   Order    |     | \- previous order not received (см. ниже что   |
|     external |     | это)                                           |
|     id       |     |                                                |
+--------------+-----+------------------------------------------------+
| -   Event    |     | Enum:                                          |
|     type     |     |                                                |
|              |     | \- previous order not received (такой признак  |
|              |     | ставится и высылается на все следующие заказы, |
|              |     | которые имеют тот же адрес, на который не      |
|              |     | удалось доставить один из текущих заказов)     |
+--------------+-----+------------------------------------------------+
| -   Event    |     |                                                |
|     datetime |     |                                                |
+--------------+-----+------------------------------------------------+

**На будущее -- усложнение асинхронной интеграции (pub/sub) на случай,
если соединение с TEEZ_PVZ упадет**

Рекомендую при первой же возможности сделать асинхронно:

-   Coube записывает в отдельную таблицу "отправить уведомление в
    TEEZ_PVZ" (см. описание pub/sub таблиц внизу ТЗ)

-   Coube триггерит отдельный сервис/процесс, который начинает
    отправлять в порядке очереди стучаться в TEEZ_PVZ **(метод тот же)**

-   На каждый отправленный заказ, Coube отмечает флажок в таблице
    интеграций. Если произошла ошибка, записывает также код ошибки.

-   Автоматически сервис/процесс ретраится раз в час

### Пометка следующих заказов для "проблемного" адреса как требующих уточнения

Если курьер нажал "Приехал, но не отдал заказ" -- COUBE проверяет, есть
ли другие *еще не доставленные* заказы на тот же адрес. Если есть, на
все эти заказы вешается флажок "Один из предыдущих заказов по данному
адресу не удалось доставить! Возможно, " в интерфейсе маршрутных листов.

Об этом событии, COUBE также стучится в TEEZ_PVZ (по тому же методу)
event type = previous order not received.

### 

### Курьер приезжает на склад

Когда курьер заканчивает поездку, он едет на курьерский склад.

Сотрудник склада вручную сверяет данные между тем, что получает от
курьера, и тем, что получает от COUBE :

-   \- заказы доставленные

-   \- заказы возвращенные

-   \- заказы не доставленные, по причине клиента

-   \- заказы не доставленные, потому что курьер не доехал

В таком случае все недоставленные заказы остаются в COUBE и должны
сняться с курьера.

Логист должен будет пересоздать их/перезагрузить в другой МЛ в TEEZ_PVZ.

## III. АНАЛИТИКА

**1. Краткий дашборд на фронтэнде моб приложения**

Общие итоги в количестве:

-   \- заказы доставленные

-   \- заказы возвращенные

-   \- заказы не доставленные, по причине клиента

-   \- заказы не доставленные, потому что курьер не доехал

**2. Подробный отчет в таблице**

**Формат:** для начала это может быть выгрузка в Excel

**Поля по столбцам:**

-   id заказа

-   текущий статус

-   дата-время определения текущего статуса

-   курьер

-   номер маршрутного листа, в который был включен этот заказ

**Строки**:

-   id заказов

## IV. ЛОГИ

### Логи событий 

Действия должны логироваться в таблицу с полями

+-------------+-------------+-------------+-----+---------------------+
| Объект      | Автор       | Тип события | Д   | Доп информация      |
|             |             |             | ата |                     |
+=============+=============+=============+=====+=====================+
| Биз         | ID          | Енам типов  |     | -   В зависимости   |
| нес-объект, | п           | событий см  |     |     от типа события |
| по которому | ользователя | ниже.       |     |     доп информация, |
| создан лог. | или         |             |     |     см. ниже        |
|             | "Внутренний |             |     |                     |
| В данном    | сервисы"    |             |     | -   \+ если автор   |
| случае это  | или         |             |     |     "Интеграция",   |
| Заявка + ее | "           |             |     |     обязательно     |
| ID.         | Интеграция" |             |     |     должно быть доп |
|             |             |             |     |     поле            |
|             |             |             |     |     описывающее     |
|             |             |             |     |     какая именно    |
|             |             |             |     |     интегрируемаяс  |
|             |             |             |     |     истема          |
|             |             |             |     |     (например       |
|             |             |             |     |     "TEEZ_PVZ")     |
+-------------+-------------+-------------+-----+---------------------+
|             |             |             |     |                     |
+-------------+-------------+-------------+-----+---------------------+

**Енам типов событий для логов:**

-   Неуспешная попытка создать маршрутный лист по интеграции

    -   Доп информация: текст ошибки

-   Загружен новый маршрутный лист

    -   доп информация: список айдишников созданных маршрутных листов

-   Изменен маршрутный лист

    -   доп информация: айдишник маршрутного листа и все изменения

### Логи интеграций (PUB/SUB таблица)

Действия должны логироваться в таблицу с полями

+-------+-------------+----+------------+----+----+--------+--------+
| О     | ID объекта  | А  | Тип        |    | Да | Доп    | Дата   |
| бъект |             | вт | события    |    | та | инфо   | у      |
|       |             | ор |            |    | по | рмация | спешно |
|       |             |    |            |    | ст |        | й/неус |
|       |             |    |            |    | ан |        | пешной |
|       |             |    |            |    | ов |        | инте   |
|       |             |    |            |    | ки |        | грации |
|       |             |    |            |    | в  |        |        |
|       |             |    |            |    | о  |        |        |
|       |             |    |            |    | че |        |        |
|       |             |    |            |    | ре |        |        |
|       |             |    |            |    | дь |        |        |
+=======+=============+====+============+====+====+========+========+
| В     | В данном    |    | Из енама.  |    |    | Полный | При    |
| д     | случае ID   |    |            |    |    | объект | неус   |
| анном | заказа.     |    | Пока что в |    |    | инфо   | пешной |
| с     |             |    | енаме      |    |    | рмации | т      |
| лучае | (Если заказ |    | только     |    |    | о      | акже + |
| "З    | неизвестен  |    | одно       |    |    | с      | текст  |
| аявка | и будет     |    | "Событие   |    |    | обытии | ошибки |
| "+"За | интеграция  |    | по заказу" |    |    |        |        |
| каз". | по заявке   |    |            |    |    |        |        |
|       | целиком --  |    |            |    |    |        |        |
|       | то будет    |    |            |    |    |        |        |
|       | айди        |    |            |    |    |        |        |
|       | заявки,т.е. |    |            |    |    |        |        |
|       | здесь       |    |            |    |    |        |        |
|       | должно быть |    |            |    |    |        |        |
|       | айди        |    |            |    |    |        |        |
|       | наиболее    |    |            |    |    |        |        |
|       | низшего     |    |            |    |    |        |        |
|       | объекта по  |    |            |    |    |        |        |
|       | иерархии)   |    |            |    |    |        |        |
+-------+-------------+----+------------+----+----+--------+--------+
|       |             |    |            |    |    |        |        |
+-------+-------------+----+------------+----+----+--------+--------+

**Енам :**

-   заказ помечен как проблемный , надо позвонить

-   заказ доставлен

-   курьер доехал но заказ не отдан в руки + причина (см. енам причин
    почему заказ не отдан в руки)

-   заказ доставлен но клиент оформил возврат
