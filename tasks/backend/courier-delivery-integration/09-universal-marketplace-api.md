# 09. –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–µ API –¥–ª—è –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å–æ–≤

## –ö–ª—é—á–µ–≤–∞—è –∫–æ–Ω—Ü–µ–ø—Ü–∏—è

API —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–Ω–æ **—É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–º** –∏ –Ω–µ –ø—Ä–∏–≤—è–∑–∞–Ω–æ –∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å—É (TEEZ).

---

## –ü–æ—á–µ–º—É —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–µ?

### 1. –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å
–°–µ–≥–æ–¥–Ω—è –∏–Ω—Ç–µ–≥—Ä–∏—Ä—É–µ–º—Å—è —Å TEEZ, –∑–∞–≤—Ç—Ä–∞ —Å Kaspi –∏–ª–∏ Wildberries ‚Äî **API –Ω–µ –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–ø–∏—Å—ã–≤–∞—Ç—å**.

### 2. –ú–µ–Ω—å—à–µ –∫–æ–¥–∞
–û–¥–∏–Ω –Ω–∞–±–æ—Ä endpoints –¥–ª—è –≤—Å–µ—Ö –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å–æ–≤. –ù–µ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –ª–æ–≥–∏–∫–∏.

### 3. –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ —Ä–æ—Å—Ç—É
–†—ã–Ω–æ–∫ –∫—É—Ä—å–µ—Ä—Å–∫–æ–π –¥–æ—Å—Ç–∞–≤–∫–∏ –≤ –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω–µ —Ä–∞—Å—Ç–µ—Ç. –ù–æ–≤—ã–µ –ø–∞—Ä—Ç–Ω–µ—Ä—ã –º–æ–≥—É—Ç –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ.

---

## –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç?

### –ü–æ–ª–µ `source_system`

–ö–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å –æ—Ç –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å–∞ —Å–æ–¥–µ—Ä–∂–∏—Ç –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –ø–æ–ª–µ `source_system`:

```json
{
  "source_system": "TEEZ_PVZ",  // –∏–ª–∏ KASPI, WILDBERRIES, OZON
  "waybill": { ... }
}
```

### –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –ø–æ API –∫–ª—é—á–∞–º

–ö–∞–∂–¥—ã–π –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å –ø–æ–ª—É—á–∞–µ—Ç —Å–≤–æ–π —É–Ω–∏–∫–∞–ª—å–Ω—ã–π API Key:

```
TEEZ_PVZ:     X-API-Key: coube_teez_abc123...
Kaspi:        X-API-Key: coube_kaspi_xyz789...
Wildberries:  X-API-Key: coube_wb_def456...
```

Coube –ø–æ–Ω–∏–º–∞–µ—Ç, –∫—Ç–æ –æ—Ç–ø—Ä–∞–≤–∏–ª –∑–∞–ø—Ä–æ—Å, –∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ.

---

## –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–µ endpoints

```
POST   /api/v1/integration/waybills            // –î–ª—è –≤—Å–µ—Ö
GET    /api/v1/integration/waybills/{id}       // –î–ª—è –≤—Å–µ—Ö
GET    /api/v1/integration/waybills/{id}/orders // –î–ª—è –≤—Å–µ—Ö
POST   /api/v1/integration/problem-address     // –î–ª—è –≤—Å–µ—Ö
```

**–ù–ï —Ç–∞–∫** (–ø—Ä–∏–≤—è–∑–∫–∞ –∫ TEEZ):
```
POST   /api/v1/integration/teez/waybills       // ‚ùå –¢–æ–ª—å–∫–æ –¥–ª—è TEEZ
```

---

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ü—Ä–∏–º–µ—Ä 1: TEEZ —Å–æ–∑–¥–∞–µ—Ç –º–∞—Ä—à—Ä—É—Ç

```bash
POST /api/v1/integration/waybills
X-API-Key: coube_teez_production_key

{
  "source_system": "TEEZ_PVZ",
  "waybill": {
    "id": "TEEZ-WB-001",
    ...
  }
}
```

### –ü—Ä–∏–º–µ—Ä 2: Kaspi —Å–æ–∑–¥–∞–µ—Ç –º–∞—Ä—à—Ä—É—Ç

```bash
POST /api/v1/integration/waybills
X-API-Key: coube_kaspi_production_key

{
  "source_system": "KASPI",
  "waybill": {
    "id": "KASPI-2025-12345",
    ...
  }
}
```

**–¢–æ—Ç –∂–µ endpoint!** –†–∞–∑–ª–∏—á–∏–µ —Ç–æ–ª—å–∫–æ –≤ `source_system` –∏ API –∫–ª—é—á–µ.

---

## –ß—Ç–æ —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ?

### ‚úÖ Endpoints
–û–¥–∏–Ω –ø—É—Ç—å –¥–ª—è –≤—Å–µ—Ö –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å–æ–≤

### ‚úÖ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö
–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è –æ–¥–∏–Ω–∞–∫–æ–≤—ã –¥–ª—è –≤—Å–µ—Ö

### ‚úÖ –õ–æ–≥–∏–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
–ü—Ä–æ–≤–µ—Ä–∫–∏ –∞–¥—Ä–µ—Å–æ–≤, –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫–æ–Ω –∏ —Ç.–¥. –æ–±—â–∏–µ

### ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
–í—Å–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –µ–¥–∏–Ω–æ–æ–±—Ä–∞–∑–Ω–æ

### ‚úÖ –ë–∏–∑–Ω–µ—Å-–ø—Ä–æ—Ü–µ—Å—Å—ã
–ò–º–ø–æ—Ä—Ç ‚Üí –≤–∞–ª–∏–¥–∞—Ü–∏—è ‚Üí –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ –∫—É—Ä—å–µ—Ä–∞ ‚Üí –¥–æ—Å—Ç–∞–≤–∫–∞ ‚Üí –æ—Ç–ø—Ä–∞–≤–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

---

## –ß—Ç–æ —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω–æ –¥–ª—è –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å–æ–≤?

### üîß –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –ø–æ–ª—è

```json
{
  "orders": [{
    "track_number": "...",       // –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–ª—è –≤—Å–µ—Ö
    "marketplace_order_id": "...", // –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, —Ñ–æ—Ä–º–∞—Ç –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å–∞
  }]
}
```

### üîß –§–æ—Ä–º–∞—Ç —Ç—Ä–µ–∫-–Ω–æ–º–µ—Ä–æ–≤

- TEEZ: `AC-XXXXXXXXX`
- Kaspi: `KASPI-AC-XXXXXXXX`
- Wildberries: `WB-XXXXXXXXXX`

### üîß URL –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

```yaml
marketplaces:
  teez:
    endpoint: /api/waybill/results
  kaspi:
    endpoint: /api/v1/courier/delivery-results
  wildberries:
    endpoint: /api/v3/delivery/results
```

---

## –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å–∞

–ß—Ç–æ–±—ã –¥–æ–±–∞–≤–∏—Ç—å Ozon:

### 1. –°–æ–∑–¥–∞—Ç—å API Key
```bash
POST /api/v1/admin/api-keys
{
  "keyName": "ozon-production",
  "sourceSystem": "OZON",
  "scopes": ["courier:integration"]
}
```

### 2. –î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
```yaml
courier:
  integration:
    marketplaces:
      ozon:
        enabled: true
        api-url: https://api.ozon.ru
        api-token: ${OZON_API_TOKEN}
        endpoint: /api/v2/posting/complete
```

### 3. –ü–µ—Ä–µ–¥–∞—Ç—å API Key –∫–æ–º–∞–Ω–¥–µ Ozon
```
X-API-Key: coube_ozon_generated_key
```

### 4. –ì–æ—Ç–æ–≤–æ!
Ozon –Ω–∞—á–∏–Ω–∞–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–µ –∂–µ endpoints —Å `source_system: "OZON"`.

**–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥–µ: 0 —Å—Ç—Ä–æ–∫!**

---

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –¥–ª—è TEEZ

TEEZ –ø–æ–ª—É—á–∞–µ—Ç:

‚úÖ –°—Ç–∞–±–∏–ª—å–Ω–æ–µ API (–Ω–µ –±—É–¥–µ—Ç –ª–æ–º–∞—Ç—å—Å—è –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –Ω–æ–≤—ã—Ö –ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤)  
‚úÖ –ü—Ä–æ—Å—Ç—É—é –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é (–æ–¥–∏–Ω –∑–∞–≥–æ–ª–æ–≤–æ–∫ `X-API-Key`)  
‚úÖ –¢–µ –∂–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏, —á—Ç–æ –∏ —É –ª—é–±–æ–≥–æ –¥—Ä—É–≥–æ–≥–æ –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å–∞  
‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫—É –≤—Å–µ—Ö —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π (–∏–º–ø–æ—Ä—Ç, –ø–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–æ–≤, –ø—Ä–æ–±–ª–µ–º–Ω—ã–µ –∞–¥—Ä–µ—Å–∞)  

---

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –¥–ª—è Coube

Coube –ø–æ–ª—É—á–∞–µ—Ç:

‚úÖ –ï–¥–∏–Ω—É—é –∫–æ–¥–æ–≤—É—é –±–∞–∑—É –¥–ª—è –≤—Å–µ—Ö –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å–æ–≤  
‚úÖ –ü—Ä–æ—Å—Ç–æ—Ç—É —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è (–æ–¥–Ω–∞ –ª–æ–≥–∏–∫–∞)  
‚úÖ –ë—ã—Å—Ç—Ä—É—é –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é –Ω–æ–≤—ã—Ö –ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤ (–º–∏–Ω—É—Ç—ã, –Ω–µ –Ω–µ–¥–µ–ª–∏)  
‚úÖ –ú–µ–Ω—å—à–µ –±–∞–≥–æ–≤ (–Ω–µ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–¥–∞)  
‚úÖ –ü—Ä–æ—Å—Ç—É—é –∞–Ω–∞–ª–∏—Ç–∏–∫—É (–µ–¥–∏–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö)  

---

## –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø–æ–¥—Ö–æ–¥–æ–≤

### ‚ùå –ü–æ–¥—Ö–æ–¥ "–¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–≤–æ–µ API"

```
/api/v1/integration/teez/waybills
/api/v1/integration/kaspi/waybills
/api/v1/integration/wildberries/waybills
```

**–ü—Ä–æ–±–ª–µ–º—ã**:
- –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞
- –°–ª–æ–∂–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- –°–ª–æ–∂–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞
- –î–æ–ª–≥–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –Ω–æ–≤—ã—Ö –ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤

### ‚úÖ –ü–æ–¥—Ö–æ–¥ "—É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–µ API"

```
/api/v1/integration/waybills  // –¥–ª—è –≤—Å–µ—Ö, —Ä–∞–∑–ª–∏—á–∏–µ –ø–æ source_system
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞**:
- –û–¥–∏–Ω –∫–æ–¥
- –ü—Ä–æ—Å—Ç–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- –ü—Ä–æ—Å—Ç–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞
- –ë—ã—Å—Ç—Ä–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –Ω–æ–≤—ã—Ö –ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤

---

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–µ API ‚Äî —ç—Ç–æ:

1. **–ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞** –¥–ª—è –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ–π –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã
2. **–≠–∫–æ–Ω–æ–º–∏—è –≤—Ä–µ–º–µ–Ω–∏** –Ω–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫—É –∏ –ø–æ–¥–¥–µ—Ä–∂–∫—É
3. **–ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –±—É–¥—É—â–µ–º—É** (–Ω–æ–≤—ã–µ –ø–∞—Ä—Ç–Ω–µ—Ä—ã = –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è, –Ω–µ –∫–æ–¥)
4. **–û–¥–∏–Ω–∞–∫–æ–≤—ã–π –æ–ø—ã—Ç** –¥–ª—è –≤—Å–µ—Ö –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å–æ–≤

TEEZ –∏–Ω—Ç–µ–≥—Ä–∏—Ä—É–µ—Ç—Å—è —Ç–∞–∫ –∂–µ –ø—Ä–æ—Å—Ç–æ, –∫–∞–∫ –∏ –ª—é–±–æ–π –¥—Ä—É–≥–æ–π –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å, –Ω–æ –ø—Ä–∏ —ç—Ç–æ–º —Å–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ —Ä–æ—Å—Ç—É. üöÄ
