# 12. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ orders[] –∏ –¥–∞–Ω–Ω—ã—Ö –æ —Ñ–æ—Ç–æ –≤ CargoLoadingResponse

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è**: 2025-11-01
**–°—Ç–∞—Ç—É—Å**: TO DO
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: HIGH
**–ê–≤—Ç–æ—Ä**: Ali (Mobile Dev)

---

## –ü—Ä–æ–±–ª–µ–º–∞

–í —Ç–µ–∫—É—â–µ–º API response –¥–ª—è —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–æ–∫ –∫—É—Ä—å–µ—Ä—Å–∫–æ–π –¥–æ—Å—Ç–∞–≤–∫–∏ –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –∑–∞–∫–∞–∑–∞—Ö –∏ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è—Ö.

**–¢–µ–∫—É—â–∞—è —Å–∏—Ç—É–∞—Ü–∏—è**:
- ‚ùå –í `cargoLoadings[]` –ù–ï –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –º–∞—Å—Å–∏–≤ `orders[]` —Å –∑–∞–∫–∞–∑–∞–º–∏ –¥–ª—è –∫–∞–∂–¥–æ–π —Ç–æ—á–∫–∏
- ‚ùå –ù–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —Ñ–æ—Ç–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –¥–æ—Å—Ç–∞–≤–∫–∏
- ‚ùå –ú–æ–±–∏–ª–∫–∞/—Ñ—Ä–æ–Ω—Ç –Ω–µ –∑–Ω–∞–µ—Ç –∫–∞–∫–∏–µ –∑–∞–∫–∞–∑—ã –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ –∫–∞–∂–¥–æ–π —Ç–æ—á–∫–µ
- ‚ùå –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –æ—Ç—Å–ª–µ–¥–∏—Ç—å —Å—Ç–∞—Ç—É—Å—ã –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤ –≤–Ω—É—Ç—Ä–∏ —Ç–æ—á–∫–∏

**–ü—Ä–æ–±–ª–µ–º–∞ –¥–ª—è –∫–ª–∏–µ–Ω—Ç–æ–≤**:
1. –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ —É–≤–∏–¥–µ—Ç—å —Å–ø–∏—Å–æ–∫ –∑–∞–∫–∞–∑–æ–≤ –≤ —Ç–æ—á–∫–µ –¥–æ—Å—Ç–∞–≤–∫–∏
2. –ù–µ—Ç —Ç—Ä–µ–∫-–Ω–æ–º–µ—Ä–æ–≤ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è
3. –ù–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ç–æ–≤–∞—Ä–Ω—ã—Ö –ø–æ–∑–∏—Ü–∏—è—Ö
4. –ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ —Ñ–æ—Ç–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–π –¥–æ—Å—Ç–∞–≤–∫–∏

---

## –†–µ—à–µ–Ω–∏–µ

–†–∞—Å—à–∏—Ä–∏—Ç—å `CargoLoadingResponse` DTO –¥–ª—è –≤–∫–ª—é—á–µ–Ω–∏—è:
1. **orders[]** - –º–∞—Å—Å–∏–≤ –∑–∞–∫–∞–∑–æ–≤ –∫—É—Ä—å–µ—Ä—Å–∫–æ–π –¥–æ—Å—Ç–∞–≤–∫–∏ –¥–ª—è –∫–∞–∂–¥–æ–π —Ç–æ—á–∫–∏
2. **photoUrls[]** - –º–∞—Å—Å–∏–≤ URL –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —Ñ–æ—Ç–æ –¥–ª—è —Ç–æ—á–∫–∏
3. **deliveryConfirmation** - –¥–∞–Ω–Ω—ã–µ –æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–∏ –¥–æ—Å—Ç–∞–≤–∫–∏

---

## –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥–µ

### 1. –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–µ DTO –¥–ª—è –∑–∞–∫–∞–∑–æ–≤ –∫—É—Ä—å–µ—Ä—Å–∫–æ–π –¥–æ—Å—Ç–∞–≤–∫–∏

**–§–∞–π–ª**: `src/main/java/kz/coube/backend/customer/dto/CourierOrderResponse.java`

```java
package kz.coube.backend.customer.dto;

import java.time.LocalDateTime;
import java.util.List;

/**
 * DTO –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –∑–∞–∫–∞–∑–µ –≤ —Ç–æ—á–∫–µ –¥–æ—Å—Ç–∞–≤–∫–∏
 */
public record CourierOrderResponse(
    Long id,
    String trackNumber,
    String externalId,
    String orderLoadType,  // "load" –∏–ª–∏ "unload"
    String status,          // "pending", "delivered", "not_delivered", "returned"
    String statusReason,    // –ü—Ä–∏—á–∏–Ω–∞ –Ω–µ–¥–æ—Å—Ç–∞–≤–∫–∏
    LocalDateTime statusDatetime,
    LocalDateTime deliveryDatetime,
    List<CourierOrderPositionResponse> positions,
    String deliveryPhotoUrl,    // URL —Ñ–æ—Ç–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
    String smsCodeUsed,         // –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–π SMS –∫–æ–¥
    String courierComment       // –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫—É—Ä—å–µ—Ä–∞
) {}
```

**–§–∞–π–ª**: `src/main/java/kz/coube/backend/customer/dto/CourierOrderPositionResponse.java`

```java
package kz.coube.backend.customer.dto;

/**
 * DTO –¥–ª—è –ø–æ–∑–∏—Ü–∏–∏ —Ç–æ–≤–∞—Ä–∞ –≤ –∑–∞–∫–∞–∑–µ
 */
public record CourierOrderPositionResponse(
    String positionCode,
    String positionShortname,
    Integer quantity,
    Integer returnedQuantity  // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–æ–∑–≤—Ä–∞—â–µ–Ω–Ω—ã—Ö
) {}
```

### 2. –û–±–Ω–æ–≤–∏—Ç—å CargoLoadingResponse.java

**–§–∞–π–ª**: `src/main/java/kz/coube/backend/customer/dto/CargoLoadingResponse.java`

**–ë—ã–ª–æ**:
```java
public record CargoLoadingResponse(
        Long id,
        LoadingType loadingType,
        Integer orderNum,
        String binShipper,
        LocalDateTime loadingDateTime,
        String address,
        GeoPointDto point,
        String commentary,
        BigDecimal weight,
        WeightUnit weightUnit,
        BigDecimal volume,
        DictionaryResponse loadingMethod,
        DictionaryResponse loadingOperation,
        Integer loadingTimeHours,
        String contactNumber,
        String contactName,
        Boolean isActive,
        Boolean isDriverAtLocation,
        Boolean isSmsRequired,      // –ò–∑ –∑–∞–¥–∞—á–∏ 11
        Boolean isPhotoRequired     // –ò–∑ –∑–∞–¥–∞—á–∏ 11
) {}
```

**–°—Ç–∞–ª–æ**:
```java
public record CargoLoadingResponse(
        Long id,
        LoadingType loadingType,
        Integer orderNum,
        String binShipper,
        LocalDateTime loadingDateTime,
        String address,
        GeoPointDto point,
        String commentary,
        BigDecimal weight,
        WeightUnit weightUnit,
        BigDecimal volume,
        DictionaryResponse loadingMethod,
        DictionaryResponse loadingOperation,
        Integer loadingTimeHours,
        String contactNumber,
        String contactName,
        Boolean isActive,
        Boolean isDriverAtLocation,
        Boolean isSmsRequired,
        Boolean isPhotoRequired,
        List<CourierOrderResponse> orders,      // ‚≠ê NEW - –º–∞—Å—Å–∏–≤ –∑–∞–∫–∞–∑–æ–≤
        List<String> photoUrls,                 // ‚≠ê NEW - URL —Ñ–æ—Ç–æ —Ç–æ—á–∫–∏
        CourierDeliveryConfirmation deliveryConfirmation  // ‚≠ê NEW - –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –¥–æ—Å—Ç–∞–≤–∫–∏
) {}
```

### 3. –°–æ–∑–¥–∞—Ç—å DTO –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –¥–æ—Å—Ç–∞–≤–∫–∏

**–§–∞–π–ª**: `src/main/java/kz/coube/backend/customer/dto/CourierDeliveryConfirmation.java`

```java
package kz.coube.backend.customer.dto;

import java.time.LocalDateTime;

/**
 * DTO –¥–ª—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–∏ –¥–æ—Å—Ç–∞–≤–∫–∏
 */
public record CourierDeliveryConfirmation(
    LocalDateTime confirmedAt,      // –í—Ä–µ–º—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
    String confirmedBy,             // –ö—Ç–æ –ø–æ–¥—Ç–≤–µ—Ä–¥–∏–ª (–∏–º—è –ø–æ–ª—É—á–∞—Ç–µ–ª—è)
    String confirmationType,        // "SMS", "PHOTO", "SIGNATURE"
    String smsCode,                // –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–π SMS –∫–æ–¥
    String signatureUrl,           // URL –ø–æ–¥–ø–∏—Å–∏ (–µ—Å–ª–∏ –µ—Å—Ç—å)
    Boolean isFullyDelivered      // –í—Å–µ –ª–∏ –∑–∞–∫–∞–∑—ã –¥–æ—Å—Ç–∞–≤–ª–µ–Ω—ã
) {}
```

### 4. –û–±–Ω–æ–≤–∏—Ç—å CustomerMapper.java

**–§–∞–π–ª**: `src/main/java/kz/coube/backend/customer/mapper/CustomerMapper.java`

```java
@Component
@RequiredArgsConstructor
public class CustomerMapper {

    private final CourierOrderRepository courierOrderRepository;
    private final FileService fileService;

    public CargoLoadingResponse toTransportationCargo(CargoLoadingHistory cargoLoading) {
        // –ü–æ–ª—É—á–∞–µ–º –∑–∞–∫–∞–∑—ã –¥–ª—è —ç—Ç–æ–π —Ç–æ—á–∫–∏
        List<CourierOrderResponse> orders = getOrdersForCargoLoading(cargoLoading);

        // –ü–æ–ª—É—á–∞–µ–º URL —Ñ–æ—Ç–æ
        List<String> photoUrls = getPhotoUrlsForCargoLoading(cargoLoading);

        // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–∏ –¥–æ—Å—Ç–∞–≤–∫–∏
        CourierDeliveryConfirmation confirmation = getDeliveryConfirmation(cargoLoading);

        return new CargoLoadingResponse(
            cargoLoading.getId(),
            cargoLoading.getLoadingType(),
            cargoLoading.getOrderNum(),
            cargoLoading.getShipperBin(),
            cargoLoading.getLoadingDatetime(),
            cargoLoading.getAddress(),
            GeoPointDto.builder()
                .lon(cargoLoading.getLocation().getX())
                .lat(cargoLoading.getLocation().getY())
                .build(),
            cargoLoading.getCommentary(),
            cargoLoading.getWeight(),
            cargoLoading.getWeightUnit(),
            cargoLoading.getVolume(),
            DictionaryResponse.fromDictionary(cargoLoading.getLoadingMethod()),
            DictionaryResponse.fromDictionary(cargoLoading.getLoadingOperation()),
            cargoLoading.getLoadingTimeHours(),
            cargoLoading.getContactNumber(),
            cargoLoading.getContactPersonName(),
            cargoLoading.getIsActive() != null ? cargoLoading.getIsActive() : false,
            cargoLoading.getIsDriverAtLocation() != null ? cargoLoading.getIsDriverAtLocation() : false,
            cargoLoading.getIsSmsRequired(),
            cargoLoading.getIsPhotoRequired(),
            orders,                    // ‚≠ê NEW
            photoUrls,                 // ‚≠ê NEW
            confirmation               // ‚≠ê NEW
        );
    }

    private List<CourierOrderResponse> getOrdersForCargoLoading(CargoLoadingHistory cargoLoading) {
        // –ü–æ–ª—É—á–∞–µ–º –∑–∞–∫–∞–∑—ã –∏–∑ –ë–î
        List<CourierRouteOrder> orders = courierOrderRepository
            .findByCargoLoadingId(cargoLoading.getId());

        return orders.stream()
            .map(this::toCourierOrderResponse)
            .toList();
    }

    private CourierOrderResponse toCourierOrderResponse(CourierRouteOrder order) {
        // –ü–æ–ª—É—á–∞–µ–º URL —Ñ–æ—Ç–æ –µ—Å–ª–∏ –µ—Å—Ç—å
        String photoUrl = order.getDeliveryPhotoId() != null
            ? fileService.getFileUrl(order.getDeliveryPhotoId())
            : null;

        // –ü–æ–ª—É—á–∞–µ–º –ø–æ–∑–∏—Ü–∏–∏ —Ç–æ–≤–∞—Ä–æ–≤
        List<CourierOrderPositionResponse> positions = order.getPositions().stream()
            .map(pos -> new CourierOrderPositionResponse(
                pos.getPositionCode(),
                pos.getPositionShortname(),
                pos.getQuantity(),
                pos.getReturnedQuantity()
            ))
            .toList();

        return new CourierOrderResponse(
            order.getId(),
            order.getTrackNumber(),
            order.getExternalId(),
            order.getOrderLoadType().toString(),
            order.getStatus() != null ? order.getStatus().toString() : "pending",
            order.getStatusReason(),
            order.getStatusDatetime(),
            order.getDeliveryDatetime(),
            positions,
            photoUrl,
            order.getSmsCodeUsed(),
            order.getCourierComment()
        );
    }

    private List<String> getPhotoUrlsForCargoLoading(CargoLoadingHistory cargoLoading) {
        // –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ —Ñ–æ—Ç–æ —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å —Ç–æ—á–∫–æ–π
        List<String> photoIds = courierOrderRepository
            .findPhotoIdsByCargoLoadingId(cargoLoading.getId());

        return photoIds.stream()
            .filter(Objects::nonNull)
            .map(fileService::getFileUrl)
            .toList();
    }

    private CourierDeliveryConfirmation getDeliveryConfirmation(CargoLoadingHistory cargoLoading) {
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –µ—Å—Ç—å –ª–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –¥–æ—Å—Ç–∞–≤–∫–∏
        if (cargoLoading.getDepartureDateTime() == null) {
            return null; // –ï—â–µ –Ω–µ –ø–æ–∫–∏–Ω—É–ª–∏ —Ç–æ—á–∫—É
        }

        // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–∏
        List<CourierRouteOrder> orders = courierOrderRepository
            .findByCargoLoadingId(cargoLoading.getId());

        boolean allDelivered = orders.stream()
            .allMatch(o -> "delivered".equals(o.getStatus()));

        String smsCode = orders.stream()
            .map(CourierRouteOrder::getSmsCodeUsed)
            .filter(Objects::nonNull)
            .findFirst()
            .orElse(null);

        return new CourierDeliveryConfirmation(
            cargoLoading.getDepartureDateTime(),
            cargoLoading.getContactPersonName(),
            cargoLoading.getIsSmsRequired() ? "SMS" : "PHOTO",
            smsCode,
            null, // signature URL –µ—Å–ª–∏ –±—É–¥–µ—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ
            allDelivered
        );
    }
}
```

### 5. –°–æ–∑–¥–∞—Ç—å Repository –¥–ª—è –∑–∞–∫–∞–∑–æ–≤

**–§–∞–π–ª**: `src/main/java/kz/coube/backend/courier/repository/CourierOrderRepository.java`

```java
package kz.coube.backend.courier.repository;

import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.data.jpa.repository.Query;
import org.springframework.data.repository.query.Param;
import java.util.List;

public interface CourierOrderRepository extends JpaRepository<CourierRouteOrder, Long> {

    /**
     * –ù–∞–π—Ç–∏ –≤—Å–µ –∑–∞–∫–∞–∑—ã –¥–ª—è —Ç–æ—á–∫–∏ –º–∞—Ä—à—Ä—É—Ç–∞
     */
    List<CourierRouteOrder> findByCargoLoadingId(Long cargoLoadingId);

    /**
     * –ù–∞–π—Ç–∏ –≤—Å–µ ID —Ñ–æ—Ç–æ –¥–ª—è —Ç–æ—á–∫–∏ –º–∞—Ä—à—Ä—É—Ç–∞
     */
    @Query("""
        SELECT o.deliveryPhotoId
        FROM CourierRouteOrder o
        WHERE o.cargoLoadingId = :cargoLoadingId
        AND o.deliveryPhotoId IS NOT NULL
    """)
    List<String> findPhotoIdsByCargoLoadingId(@Param("cargoLoadingId") Long cargoLoadingId);

    /**
     * –ù–∞–π—Ç–∏ –∑–∞–∫–∞–∑—ã –ø–æ —Ç—Ä–µ–∫-–Ω–æ–º–µ—Ä–∞–º
     */
    List<CourierRouteOrder> findByTrackNumberIn(List<String> trackNumbers);
}
```

---

## API Response Examples

### –î–æ –∏–∑–º–µ–Ω–µ–Ω–∏–π

```json
GET /api/v1/customer/transportations/1269
{
  "transportationCargoInfoResponse": {
    "cargoLoadings": [{
      "id": 2738,
      "loadingType": {
        "code": "UNLOADING"
      },
      "orderNum": 2,
      "address": "–ê–ª–º–∞—Ç—ã, –º–∫—Ä. –°–∞–º–∞–ª-2, –¥–æ–º 22, –∫–≤. 12",
      "point": {
        "lon": 76.9562,
        "lat": 43.2385
      },
      "contactNumber": "+77478777626",
      "contactName": "–ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤–∏—á",
      "isSmsRequired": true,
      "isPhotoRequired": true
      // ‚ùå –ù–ï–¢ orders[]
      // ‚ùå –ù–ï–¢ photoUrls[]
      // ‚ùå –ù–ï–¢ deliveryConfirmation
    }]
  }
}
```

### –ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π

```json
GET /api/v1/customer/transportations/1269
{
  "transportationCargoInfoResponse": {
    "cargoLoadings": [{
      "id": 2738,
      "loadingType": {
        "code": "UNLOADING"
      },
      "orderNum": 2,
      "address": "–ê–ª–º–∞—Ç—ã, –º–∫—Ä. –°–∞–º–∞–ª-2, –¥–æ–º 22, –∫–≤. 12",
      "point": {
        "lon": 76.9562,
        "lat": 43.2385
      },
      "contactNumber": "+77478777626",
      "contactName": "–ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤–∏—á",
      "isSmsRequired": true,
      "isPhotoRequired": true,
      "orders": [                           // ‚úÖ NEW
        {
          "id": 1001,
          "trackNumber": "TRACK-85",
          "externalId": "ORDER-TEEZ-001",
          "orderLoadType": "unload",
          "status": "delivered",
          "statusReason": null,
          "statusDatetime": "2025-01-07T10:15:00Z",
          "deliveryDatetime": "2025-01-07T10:15:00Z",
          "positions": [
            {
              "positionCode": "POS-001",
              "positionShortname": "–¢–æ–≤–∞—Ä 1",
              "quantity": 1,
              "returnedQuantity": 0
            },
            {
              "positionCode": "POS-002",
              "positionShortname": "–¢–æ–≤–∞—Ä 2",
              "quantity": 1,
              "returnedQuantity": 0
            }
          ],
          "deliveryPhotoUrl": "https://s3.coube.kz/courier/photos/1234.jpg",
          "smsCodeUsed": "5678",
          "courierComment": null
        }
      ],
      "photoUrls": [                       // ‚úÖ NEW
        "https://s3.coube.kz/courier/photos/1234.jpg"
      ],
      "deliveryConfirmation": {           // ‚úÖ NEW
        "confirmedAt": "2025-01-07T10:20:00Z",
        "confirmedBy": "–ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤–∏—á",
        "confirmationType": "SMS",
        "smsCode": "5678",
        "signatureUrl": null,
        "isFullyDelivered": true
      }
    }]
  }
}
```

### –î–ª—è –º–æ–±–∏–ª—å–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (GET /api/v1/driver/orders)

```json
{
  "content": [{
    "transportationCargoInfoResponse": {
      "cargoLoadings": [{
        "id": 2738,
        "address": "–ê–ª–º–∞—Ç—ã, –º–∫—Ä. –°–∞–º–∞–ª-2, –¥–æ–º 22, –∫–≤. 12",
        "contactNumber": "+77478777626",
        "contactName": "–ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤–∏—á",
        "isActive": true,
        "isDriverAtLocation": true,
        "isSmsRequired": true,
        "isPhotoRequired": true,
        "orders": [                        // ‚úÖ –ó–∞–∫–∞–∑—ã –≤ —Ç–æ—á–∫–µ
          {
            "id": 1001,
            "trackNumber": "TRACK-85",
            "externalId": "ORDER-TEEZ-001",
            "status": "pending",          // –ï—â–µ –Ω–µ –¥–æ—Å—Ç–∞–≤–ª–µ–Ω
            "positions": [
              {
                "positionCode": "POS-001",
                "positionShortname": "–¢–æ–≤–∞—Ä 1",
                "quantity": 1
              }
            ],
            "deliveryPhotoUrl": null      // –§–æ—Ç–æ –µ—â–µ –Ω–µ—Ç
          }
        ],
        "photoUrls": [],                  // –§–æ—Ç–æ –µ—â–µ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã
        "deliveryConfirmation": null      // –ï—â–µ –Ω–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ
      }]
    }
  }]
}
```

---

## –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

### –¢–∞–±–ª–∏—Ü–∞ courier_route_order (—É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏–∑ –∑–∞–¥–∞—á–∏ 01)

```sql
CREATE TABLE courier_route_order (
    id BIGSERIAL PRIMARY KEY,
    cargo_loading_id BIGINT NOT NULL REFERENCES gis.cargo_loading_history(id),
    track_number VARCHAR(100) NOT NULL,
    external_id VARCHAR(100),
    order_load_type VARCHAR(50) NOT NULL,
    status VARCHAR(50),
    status_reason VARCHAR(255),
    status_datetime TIMESTAMP,
    delivery_datetime TIMESTAMP,
    delivery_photo_id VARCHAR(255),
    sms_code_used VARCHAR(10),
    courier_comment TEXT,
    created_at TIMESTAMP NOT NULL DEFAULT NOW(),
    updated_at TIMESTAMP NOT NULL DEFAULT NOW(),
    UNIQUE(track_number, cargo_loading_id)
);

CREATE INDEX idx_courier_route_order_cargo_loading ON courier_route_order(cargo_loading_id);
CREATE INDEX idx_courier_route_order_track ON courier_route_order(track_number);
```

### –¢–∞–±–ª–∏—Ü–∞ courier_order_position (—É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏–∑ –∑–∞–¥–∞—á–∏ 01)

```sql
CREATE TABLE courier_order_position (
    id BIGSERIAL PRIMARY KEY,
    order_id BIGINT NOT NULL REFERENCES courier_route_order(id),
    position_code VARCHAR(100) NOT NULL,
    position_shortname VARCHAR(255),
    quantity INTEGER DEFAULT 1,
    returned_quantity INTEGER DEFAULT 0,
    created_at TIMESTAMP NOT NULL DEFAULT NOW()
);

CREATE INDEX idx_courier_order_position_order ON courier_order_position(order_id);
```

---

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å GET /api/v1/customer/transportations/{id}

```bash
curl -X GET "http://localhost:5173/api/v1/customer/transportations/1269" \
  -H "Authorization: Bearer {token}"
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç**:
- ‚úÖ –ö–∞–∂–¥—ã–π `cargoLoading` —Å–æ–¥–µ—Ä–∂–∏—Ç –º–∞—Å—Å–∏–≤ `orders[]`
- ‚úÖ –î–ª—è –¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤ –µ—Å—Ç—å `deliveryPhotoUrl`
- ‚úÖ –ï—Å–ª–∏ —Ç–æ—á–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞, –µ—Å—Ç—å `deliveryConfirmation`

### 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å GET /api/v1/driver/orders

```bash
curl -X GET "https://stage-platform.coube.kz/api/v1/driver/orders" \
  -H "Authorization: Bearer {driver_token}"
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç**:
- ‚úÖ –í–æ–¥–∏—Ç–µ–ª—å –≤–∏–¥–∏—Ç –∑–∞–∫–∞–∑—ã –≤ –∫–∞–∂–¥–æ–π —Ç–æ—á–∫–µ
- ‚úÖ –í–∏–¥–Ω—ã —Ç—Ä–µ–∫-–Ω–æ–º–µ—Ä–∞ –∏ –ø–æ–∑–∏—Ü–∏–∏ —Ç–æ–≤–∞—Ä–æ–≤
- ‚úÖ –î–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö –¥–æ—Å—Ç–∞–≤–æ–∫ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è —Ñ–æ—Ç–æ

### 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –∑–∞–∫–∞–∑–∞

```bash
# –î–æ—Å—Ç–∞–≤–∏—Ç—å –∑–∞–∫–∞–∑
curl -X PUT "https://stage-platform.coube.kz/api/v1/courier/orders/1269/courier-orders/1001/status" \
  -H "Authorization: Bearer {driver_token}" \
  -H "Content-Type: application/json" \
  -d '{
    "status": "delivered",
    "smsCode": "1234",
    "photoId": "550e8400-e29b-41d4-a716-446655440000"
  }'

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
curl -X GET "http://localhost:5173/api/v1/customer/transportations/1269" \
  -H "Authorization: Bearer {token}"
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç**:
- ‚úÖ –°—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞ –∏–∑–º–µ–Ω–∏–ª—Å—è –Ω–∞ `delivered`
- ‚úÖ –ü–æ—è–≤–∏–ª—Å—è `deliveryPhotoUrl` —Å —Å—Å—ã–ª–∫–æ–π –Ω–∞ —Ñ–æ—Ç–æ
- ‚úÖ –ó–∞–ø–æ–ª–Ω–µ–Ω `smsCodeUsed`

---

## Testing Checklist

### API Response Structure
- [ ] `orders[]` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –¥–ª—è –∫–∞–∂–¥–æ–≥–æ `cargoLoading`
- [ ] –ö–∞–∂–¥—ã–π order —Å–æ–¥–µ—Ä–∂–∏—Ç `trackNumber` –∏ `externalId`
- [ ] –ü–æ–∑–∏—Ü–∏–∏ —Ç–æ–≤–∞—Ä–æ–≤ (`positions[]`) –ø—Ä–∞–≤–∏–ª—å–Ω–æ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è
- [ ] URL —Ñ–æ—Ç–æ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Ñ–æ—Ä–º–∏—Ä—É—é—Ç—Å—è —á–µ—Ä–µ–∑ FileService

### –°—Ç–∞—Ç—É—Å—ã –∑–∞–∫–∞–∑–æ–≤
- [ ] –°—Ç–∞—Ç—É—Å `pending` –¥–ª—è –Ω–æ–≤—ã—Ö –∑–∞–∫–∞–∑–æ–≤
- [ ] –°—Ç–∞—Ç—É—Å `delivered` –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –¥–æ—Å—Ç–∞–≤–∫–∏
- [ ] –°—Ç–∞—Ç—É—Å `not_delivered` –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç–∞–≤–∫–µ
- [ ] –°—Ç–∞—Ç—É—Å `returned` –ø—Ä–∏ –≤–æ–∑–≤—Ä–∞—Ç–µ –Ω–∞ —Å–∫–ª–∞–¥

### –§–æ—Ç–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
- [ ] `deliveryPhotoUrl` –ø–æ—è–≤–ª—è–µ—Ç—Å—è –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ
- [ ] `photoUrls[]` —Å–æ–¥–µ—Ä–∂–∏—Ç –≤—Å–µ —Ñ–æ—Ç–æ —Ç–æ—á–∫–∏
- [ ] URL —Ñ–æ—Ç–æ –¥–æ—Å—Ç—É–ø–Ω—ã –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è

### –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –¥–æ—Å—Ç–∞–≤–∫–∏
- [ ] `deliveryConfirmation` –∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ç–æ—á–∫–∏
- [ ] `confirmationType` –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è (SMS/PHOTO)
- [ ] `isFullyDelivered` –ø—Ä–∞–≤–∏–ª—å–Ω–æ –≤—ã—á–∏—Å–ª—è–µ—Ç—Å—è

### –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å
- [ ] –°—Ç–∞—Ä—ã–µ –∫–ª–∏–µ–Ω—Ç—ã —Ä–∞–±–æ—Ç–∞—é—Ç (nullable –ø–æ–ª—è)
- [ ] FLT –ø–µ—Ä–µ–≤–æ–∑–∫–∏ –Ω–µ –∑–∞—Ç—Ä–æ–Ω—É—Ç—ã
- [ ] –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç

---

## –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

### –¢—Ä–µ–±—É–µ—Ç—Å—è –¥–æ –Ω–∞—á–∞–ª–∞
- ‚úÖ –¢–∞–±–ª–∏—Ü–∞ `courier_route_order` (–∏–∑ –∑–∞–¥–∞—á–∏ 01-mvp-plan.md)
- ‚úÖ –¢–∞–±–ª–∏—Ü–∞ `courier_order_position` (–∏–∑ –∑–∞–¥–∞—á–∏ 01-mvp-plan.md)
- ‚úÖ FileService –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ URL —Ñ–æ—Ç–æ
- ‚úÖ –ü–æ–ª—è `isSmsRequired` –∏ `isPhotoRequired` (–∏–∑ –∑–∞–¥–∞—á–∏ 11)

### –ë–ª–æ–∫–∏—Ä—É–µ—Ç
- üîí –ú–æ–±–∏–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ - –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∑–∞–∫–∞–∑–æ–≤ –≤ —Ç–æ—á–∫–∞—Ö
- üîí –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å - –ø—Ä–æ—Å–º–æ—Ç—Ä –¥–µ—Ç–∞–ª–µ–π –¥–æ—Å—Ç–∞–≤–∫–∏
- üîí TEEZ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è - –ø–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–æ–≤ –∑–∞–∫–∞–∑–æ–≤

---

## –û—Ü–µ–Ω–∫–∞ –≤—Ä–µ–º–µ–Ω–∏

### Backend —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞: 4-6 —á–∞—Å–æ–≤
- Entity –∏ Repository: 1 —á–∞—Å
- DTO –∏ –º–∞–ø–ø–∏–Ω–≥: 2 —á–∞—Å–∞
- –°–µ—Ä–≤–∏—Å–Ω–∞—è –ª–æ–≥–∏–∫–∞: 1-2 —á–∞—Å–∞
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ: 1 —á–∞—Å

### Frontend/Mobile –∞–¥–∞–ø—Ç–∞—Ü–∏—è: 2-3 —á–∞—Å–∞
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–∏–ø–æ–≤: 30 –º–∏–Ω—É—Ç
- UI –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∑–∞–∫–∞–∑–æ–≤: 1-2 —á–∞—Å–∞
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ: 30 –º–∏–Ω—É—Ç

**–û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞**: 6-9 —á–∞—Å–æ–≤

---

## –†–∏—Å–∫–∏

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ
- üü° **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**: –ü—Ä–∏ –±–æ–ª—å—à–æ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ –∑–∞–∫–∞–∑–æ–≤ –º–æ–∂–µ—Ç –∑–∞–º–µ–¥–ª–∏—Ç—å—Å—è –∑–∞–≥—Ä—É–∑–∫–∞
  - **–ú–∏—Ç–∏–≥–∞—Ü–∏—è**: –î–æ–±–∞–≤–∏—Ç—å –ø–∞–≥–∏–Ω–∞—Ü–∏—é –∏–ª–∏ –ª–µ–Ω–∏–≤—É—é –∑–∞–≥—Ä—É–∑–∫—É

- üü° **–†–∞–∑–º–µ—Ä response**: –£–≤–µ–ª–∏—á–∏—Ç—Å—è —Ä–∞–∑–º–µ—Ä JSON –æ—Ç–≤–µ—Ç–∞
  - **–ú–∏—Ç–∏–≥–∞—Ü–∏—è**: –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä `includeOrders=true`

### –ë–∏–∑–Ω–µ—Å
- üü¢ **–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ**: –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞

---

## –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è

### –í–∞—Ä–∏–∞–Ω—Ç 1: –û—Ç–¥–µ–ª—å–Ω—ã–π endpoint –¥–ª—è –∑–∞–∫–∞–∑–æ–≤
```
GET /api/v1/customer/transportations/{id}/cargo-loadings/{loadingId}/orders
```
**–ü–ª—é—Å—ã**: –ú–µ–Ω—å—à–µ –¥–∞–Ω–Ω—ã—Ö –≤ –æ—Å–Ω–æ–≤–Ω–æ–º response
**–ú–∏–Ω—É—Å—ã**: –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã, —É—Å–ª–æ–∂–Ω–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞

### –í–∞—Ä–∏–∞–Ω—Ç 2: GraphQL
**–ü–ª—é—Å—ã**: –ì–∏–±–∫–æ—Å—Ç—å –∑–∞–ø—Ä–æ—Å–æ–≤
**–ú–∏–Ω—É—Å—ã**: –¢—Ä–µ–±—É–µ—Ç –≤–Ω–µ–¥—Ä–µ–Ω–∏—è GraphQL –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã

### –í—ã–±—Ä–∞–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ
–†–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ DTO - –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å –º–µ–∂–¥—É —É–¥–æ–±—Å—Ç–≤–æ–º –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é.

---

## References

- **Entity**: `CourierRouteOrder.java` (–∏–∑ –∑–∞–¥–∞—á–∏ 01)
- **DTO**: `CargoLoadingResponse.java`
- **Mapper**: `CustomerMapper.java`
- **Service**: `CourierIntegrationService.java`
- **Controller**: `CustomerTransportationController.java`, `DriverController.java`
- **–°–≤—è–∑–∞–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏**: 01-mvp-plan.md, 11-add-sms-photo-required-fields.md

---

## Notes

1. **–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω–æ**: –≠—Ç–∞ –∑–∞–¥–∞—á–∞ –±–ª–æ–∫–∏—Ä—É–µ—Ç –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—É—é —Ä–∞–±–æ—Ç—É –∫—É—Ä—å–µ—Ä—Å–∫–æ–π –¥–æ—Å—Ç–∞–≤–∫–∏
2. **Backward compatibility**: –í—Å–µ –Ω–æ–≤—ã–µ –ø–æ–ª—è nullable –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
3. **Performance**: –†–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è —á–∞—Å—Ç–æ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º—ã—Ö –¥–∞–Ω–Ω—ã—Ö
4. **Security**: URL —Ñ–æ—Ç–æ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∑–∞—â–∏—â–µ–Ω—ã (–ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞)

---

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: HIGH - –±–ª–æ–∫–∏—Ä—É–µ—Ç –º–æ–±–∏–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
**Estimated**: 6-9 —á–∞—Å–æ–≤ (backend + frontend)
**Dependencies**: –ó–∞–¥–∞—á–∏ 01 –∏ 11 –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω—ã
**–°—Ç–∞—Ç—É—Å**: TO DO