# 21. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –ª–æ–≥–∏—Å—Ç–∞ –ø—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ –º–∞—Ä—à—Ä—É—Ç–æ–≤ –æ—Ç TEEZ

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è**: 2025-12-19
**–°—Ç–∞—Ç—É—Å**: TO DO
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: HIGH
**–ê–≤—Ç–æ—Ä**: Ali

---

## –ü—Ä–æ–±–ª–µ–º–∞

–ü—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ –º–∞—Ä—à—Ä—É—Ç–Ω—ã—Ö –ª–∏—Å—Ç–æ–≤ –æ—Ç TEEZ —á–µ—Ä–µ–∑ API –Ω—É–∂–Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞–∑–Ω–∞—á–∞—Ç—å –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –ª–æ–≥–∏—Å—Ç–∞. –í –æ–¥–Ω–æ–º –≥–æ—Ä–æ–¥–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ê–ª–º–∞—Ç—ã) –º–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –ª–æ–≥–∏—Å—Ç–æ–≤, –∏ –º–∞—Ä—à—Ä—É—Ç—ã –¥–æ–ª–∂–Ω—ã —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è—Ç—å—Å—è –º–µ–∂–¥—É –Ω–∏–º–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å–∫–ª–∞–¥–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è.

**–¢–µ–∫—É—â–∞—è —Å–∏—Ç—É–∞—Ü–∏—è**:
- ‚úÖ TEEZ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç waybill —Å –ø–æ–ª–µ–º `warehouseId` (–Ω–∞–ø—Ä–∏–º–µ—Ä, "58")
- ‚úÖ Backend –Ω–∞—Ö–æ–¥–∏—Ç —Å–∫–ª–∞–¥ –ø–æ `partner_warehouse_id` = 58
- ‚ùå –ù–æ –Ω–µ –Ω–∞–∑–Ω–∞—á–∞–µ—Ç –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –ª–æ–≥–∏—Å—Ç–∞
- ‚ùå –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–∞—è–≤–∫–∏ –∏–º–µ—é—Ç `createdBy = "SYSTEM_IMPORT"`
- ‚ùå –õ–æ–≥–∏—Å—Ç –Ω–µ –º–æ–∂–µ—Ç –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å —Å–≤–æ–∏ –∑–∞—è–≤–∫–∏

**–†–µ—à–µ–Ω–∏–µ TEEZ**:
TEEZ –ø—Ä–µ–¥–ª–æ–∂–∏–ª –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–µ –ø–æ–ª–µ `warehouseId`. –ò—Ö admin-–ª–æ–≥–∏—Å—Ç –±—É–¥–µ—Ç –ø—Ä–∏–≤—è–∑—ã–≤–∞—Ç—å —Å–∫–ª–∞–¥—ã –∫ –ª–æ–≥–∏—Å—Ç–∞–º –≤ UI Coube, –∏—Å–ø–æ–ª—å–∑—É—è –ø–æ–Ω—è—Ç–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Å–∫–ª–∞–¥–∞ (–ø–æ–ª–µ `abbreviation`, –Ω–∞–ø—Ä–∏–º–µ—Ä "PET-55").

---

## –†–µ—à–µ–Ω–∏–µ

### –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–µ –ø–æ–ª–µ `contactEmployee`

**–í–∞–∂–Ω–æ**: –í Transportation —É–∂–µ –µ—Å—Ç—å –ø–æ–ª–µ `contactEmployee` - —ç—Ç–æ –ª–æ–≥–∏—Å—Ç TEEZ, –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π –∑–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–∞—Ä—à—Ä—É—Ç–æ–º.

**–°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–æ–ª—è –≤ Transportation**:
- `contactEmployee` - –ª–æ–≥–∏—Å—Ç TEEZ, –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π –∑–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–∞—Ä—à—Ä—É—Ç–æ–º (**–∏—Å–ø–æ–ª—å–∑—É–µ–º —ç—Ç–æ**)
- `executorEmployee` - –≤–æ–¥–∏—Ç–µ–ª—å/–∫—É—Ä—å–µ—Ä TEEZ, –≤—ã–ø–æ–ª–Ω—è—é—â–∏–π –º–∞—Ä—à—Ä—É—Ç (–Ω–∞–∑–Ω–∞—á–∞–µ—Ç—Å—è –ø–æ–∑–∂–µ)
- `createdBy` - String username —Å–æ–∑–¥–∞—Ç–µ–ª—è (–Ω–∞–ø—Ä–∏–º–µ—Ä "SYSTEM_IMPORT")

**–õ–æ–≥–∏–∫–∞**:
1. –°–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É `courier_warehouse_logist_assignment` –¥–ª—è –ø—Ä–∏–≤—è–∑–∫–∏ —Å–∫–ª–∞–¥–æ–≤ –∫ –ª–æ–≥–∏—Å—Ç–∞–º
2. –ü—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ –æ—Ç TEEZ: –Ω–∞–π—Ç–∏ –ª–æ–≥–∏—Å—Ç–∞ –ø–æ warehouse ‚Üí –Ω–∞–∑–Ω–∞—á–∏—Ç—å –≤ `contactEmployee`
3. –õ–æ–≥–∏—Å—Ç —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç —Å–≤–æ–∏ –∑–∞—è–≤–∫–∏ –ø–æ `contactEmployee.id = currentEmployeeId`

---

### –®–∞–≥ 1: –°–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É –¥–ª—è –ø—Ä–∏–≤—è–∑–∫–∏ —Å–∫–ª–∞–¥–æ–≤ –∫ –ª–æ–≥–∏—Å—Ç–∞–º

#### –ú–∏–≥—Ä–∞—Ü–∏—è: –°–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É courier_warehouse_logist_assignment

**–§–∞–π–ª**: `V20251219_1__create_warehouse_logist_assignment.sql`

```sql
CREATE TABLE applications.courier_warehouse_logist_assignment (
    id BIGSERIAL PRIMARY KEY,

    -- –°–∫–ª–∞–¥ (Foreign Key –∫ courier_warehouse)
    warehouse_id UUID NOT NULL,

    -- –û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π –ª–æ–≥–∏—Å—Ç (Foreign Key –∫ employee)
    logist_employee_id BIGINT NOT NULL,

    -- –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç (–¥–ª—è —Å–ª—É—á–∞—è –∫–æ–≥–¥–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ –ª–æ–≥–∏—Å—Ç–æ–≤ –Ω–∞ –æ–¥–∏–Ω —Å–∫–ª–∞–¥)
    priority INT DEFAULT 1,

    -- –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å
    is_active BOOLEAN DEFAULT TRUE,

    -- –ê—É–¥–∏—Ç
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    created_by VARCHAR(255),
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_by VARCHAR(255),

    -- Constraints
    CONSTRAINT fk_warehouse_logist_warehouse
        FOREIGN KEY (warehouse_id)
        REFERENCES applications.courier_warehouse(id)
        ON DELETE CASCADE,

    CONSTRAINT fk_warehouse_logist_employee
        FOREIGN KEY (logist_employee_id)
        REFERENCES users.employee(id)
        ON DELETE CASCADE,

    -- –£–Ω–∏–∫–∞–ª—å–Ω–∞—è –∫–æ–º–±–∏–Ω–∞—Ü–∏—è (–æ–¥–∏–Ω —Å–∫–ª–∞–¥ - –æ–¥–∏–Ω –ª–æ–≥–∏—Å—Ç)
    CONSTRAINT uq_warehouse_logist
        UNIQUE (warehouse_id, logist_employee_id)
);

-- –ò–Ω–¥–µ–∫—Å—ã
CREATE INDEX idx_warehouse_assignment_warehouse
    ON applications.courier_warehouse_logist_assignment(warehouse_id)
    WHERE is_active = TRUE;

CREATE INDEX idx_warehouse_assignment_employee
    ON applications.courier_warehouse_logist_assignment(logist_employee_id)
    WHERE is_active = TRUE;

-- –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏
COMMENT ON TABLE applications.courier_warehouse_logist_assignment IS
    '–ü—Ä–∏–≤—è–∑–∫–∞ —Å–∫–ª–∞–¥–æ–≤ –∫ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–º –ª–æ–≥–∏—Å—Ç–∞–º –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è';

COMMENT ON COLUMN applications.courier_warehouse_logist_assignment.priority IS
    '–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –ª–æ–≥–∏—Å—Ç–∞ (1 = –≤—ã—Å—à–∏–π). –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –µ—Å–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ –ª–æ–≥–∏—Å—Ç–æ–≤ –Ω–∞ –æ–¥–∏–Ω —Å–∫–ª–∞–¥';
```

**–ü–æ–ª—è —Ç–∞–±–ª–∏—Ü—ã**:
- `warehouse_id` - UUID —Å–∫–ª–∞–¥–∞ –∏–∑ —Ç–∞–±–ª–∏—Ü—ã `courier_warehouse`
- `logist_employee_id` - ID –ª–æ–≥–∏—Å—Ç–∞ –∏–∑ —Ç–∞–±–ª–∏—Ü—ã `employee`
- `priority` - –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç (1 = –≤—ã—Å—à–∏–π) –¥–ª—è –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∏ –Ω–∞–≥—Ä—É–∑–∫–∏
- `is_active` - —Ñ–ª–∞–≥ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ (–¥–ª—è –∞—Ä—Ö–∏–≤–∞—Ü–∏–∏ —Å—Ç–∞—Ä—ã—Ö –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–π)

---

### –®–∞–≥ 2: Backend - Entity

**–§–∞–π–ª**: `src/main/java/kz/coube/backend/applications/entity/CourierWarehouseLogistAssignment.java`

```java
package kz.coube.backend.applications.entity;

import jakarta.persistence.*;
import kz.coube.backend.common.entity.BasedAuditEntity;
import kz.coube.backend.users.entity.Employee;
import lombok.AllArgsConstructor;
import lombok.Getter;
import lombok.NoArgsConstructor;
import lombok.Setter;

import java.util.UUID;

@Entity
@Table(
    name = "courier_warehouse_logist_assignment",
    schema = "applications",
    uniqueConstraints = {
        @UniqueConstraint(
            name = "uq_warehouse_logist",
            columnNames = {"warehouse_id", "logist_employee_id"}
        )
    },
    indexes = {
        @Index(name = "idx_warehouse_assignment_warehouse", columnList = "warehouse_id"),
        @Index(name = "idx_warehouse_assignment_employee", columnList = "logist_employee_id")
    }
)
@Getter
@Setter
@NoArgsConstructor
@AllArgsConstructor
public class CourierWarehouseLogistAssignment extends BasedAuditEntity {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    /**
     * –°–∫–ª–∞–¥ –∫—É—Ä—å–µ—Ä—Å–∫–æ–π –¥–æ—Å—Ç–∞–≤–∫–∏
     */
    @ManyToOne(fetch = FetchType.LAZY)
    @JoinColumn(name = "warehouse_id", nullable = false)
    private CourierWarehouse warehouse;

    /**
     * –û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π –ª–æ–≥–∏—Å—Ç TEEZ
     */
    @ManyToOne(fetch = FetchType.LAZY)
    @JoinColumn(name = "logist_employee_id", nullable = false)
    private Employee logistEmployee;

    /**
     * –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –ª–æ–≥–∏—Å—Ç–∞ (1 = –≤—ã—Å—à–∏–π)
     * –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∏ –Ω–∞–≥—Ä—É–∑–∫–∏ –º–µ–∂–¥—É –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –ª–æ–≥–∏—Å—Ç–∞–º–∏
     */
    @Column(name = "priority", nullable = false)
    private Integer priority = 1;

    /**
     * –§–ª–∞–≥ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
     */
    @Column(name = "is_active", nullable = false)
    private Boolean isActive = true;
}
```

---

### –®–∞–≥ 3: Backend - Repository

**–§–∞–π–ª**: `src/main/java/kz/coube/backend/applications/repository/CourierWarehouseLogistAssignmentRepository.java`

```java
package kz.coube.backend.applications.repository;

import kz.coube.backend.applications.entity.CourierWarehouseLogistAssignment;
import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.data.jpa.repository.Query;
import org.springframework.data.repository.query.Param;
import org.springframework.stereotype.Repository;

import java.util.List;
import java.util.Optional;
import java.util.UUID;

@Repository
public interface CourierWarehouseLogistAssignmentRepository extends JpaRepository<CourierWarehouseLogistAssignment, Long> {

    /**
     * –ù–∞–π—Ç–∏ –∞–∫—Ç–∏–≤–Ω–æ–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ –¥–ª—è —Å–∫–ª–∞–¥–∞ —Å –Ω–∞–∏–≤—ã—Å—à–∏–º –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–º
     */
    @Query("""
        SELECT a FROM CourierWarehouseLogistAssignment a
        WHERE a.warehouse.id = :warehouseId
          AND a.isActive = true
        ORDER BY a.priority ASC
        LIMIT 1
        """)
    Optional<CourierWarehouseLogistAssignment> findActiveByWarehouseIdOrderByPriority(
        @Param("warehouseId") UUID warehouseId
    );

    /**
     * –ù–∞–π—Ç–∏ –≤—Å–µ –∞–∫—Ç–∏–≤–Ω—ã–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è —Å–∫–ª–∞–¥–∞
     */
    List<CourierWarehouseLogistAssignment> findByWarehouse_IdAndIsActiveTrueOrderByPriorityAsc(UUID warehouseId);

    /**
     * –ù–∞–π—Ç–∏ –≤—Å–µ —Å–∫–ª–∞–¥—ã, –Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã–µ –Ω–∞ –ª–æ–≥–∏—Å—Ç–∞
     */
    List<CourierWarehouseLogistAssignment> findByLogistEmployee_IdAndIsActiveTrue(Long employeeId);

    /**
     * –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ –∞–∫—Ç–∏–≤–Ω–æ–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ –¥–ª—è —Å–∫–ª–∞–¥–∞ –∏ –ª–æ–≥–∏—Å—Ç–∞
     */
    boolean existsByWarehouse_IdAndLogistEmployee_IdAndIsActiveTrue(UUID warehouseId, Long employeeId);

    /**
     * –ù–∞–π—Ç–∏ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Å–∫–ª–∞–¥–∞ –∏ –ª–æ–≥–∏—Å—Ç–∞
     */
    Optional<CourierWarehouseLogistAssignment> findByWarehouse_IdAndLogistEmployee_Id(
        UUID warehouseId,
        Long employeeId
    );
}
```

---

### –®–∞–≥ 4: Backend - Service

**–§–∞–π–ª**: `src/main/java/kz/coube/backend/applications/service/CourierWarehouseLogistAssignmentService.java`

```java
package kz.coube.backend.applications.service;

import kz.coube.backend.applications.entity.CourierWarehouse;
import kz.coube.backend.applications.entity.CourierWarehouseLogistAssignment;
import kz.coube.backend.applications.repository.CourierWarehouseLogistAssignmentRepository;
import kz.coube.backend.applications.repository.CourierWarehouseRepository;
import kz.coube.backend.common.exception.NotFoundException;
import kz.coube.backend.users.entity.Employee;
import kz.coube.backend.users.repository.EmployeeRepository;
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;

import java.util.List;
import java.util.Optional;
import java.util.UUID;

@Service
@RequiredArgsConstructor
@Slf4j
public class CourierWarehouseLogistAssignmentService {

    private final CourierWarehouseLogistAssignmentRepository assignmentRepository;
    private final CourierWarehouseRepository warehouseRepository;
    private final EmployeeRepository employeeRepository;

    /**
     * –ù–∞–π—Ç–∏ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –ª–æ–≥–∏—Å—Ç–∞ –¥–ª—è —Å–∫–ª–∞–¥–∞
     * –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ª–æ–≥–∏—Å—Ç–∞ —Å –Ω–∞–∏–≤—ã—Å—à–∏–º –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–º
     */
    @Transactional(readOnly = true)
    public Optional<Employee> findLogistForWarehouse(CourierWarehouse warehouse) {
        return assignmentRepository
            .findActiveByWarehouseIdOrderByPriority(warehouse.getId())
            .map(CourierWarehouseLogistAssignment::getLogistEmployee);
    }

    /**
     * –ù–∞–π—Ç–∏ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –ª–æ–≥–∏—Å—Ç–∞ –ø–æ partner_warehouse_id –∏ source_system
     * –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ –º–∞—Ä—à—Ä—É—Ç–æ–≤ –æ—Ç TEEZ
     */
    @Transactional(readOnly = true)
    public Optional<Employee> findLogistByPartnerWarehouseId(
            String partnerWarehouseId,
            String sourceSystem) {

        log.debug("Finding logist for warehouse: partnerWarehouseId={}, sourceSystem={}",
            partnerWarehouseId, sourceSystem);

        Integer partnerId = Integer.parseInt(partnerWarehouseId);

        Optional<CourierWarehouse> warehouse = warehouseRepository
            .findActiveByPartnerIdAndSource(partnerId, sourceSystem);

        if (warehouse.isEmpty()) {
            log.warn("Warehouse not found: partnerWarehouseId={}, sourceSystem={}",
                partnerWarehouseId, sourceSystem);
            return Optional.empty();
        }

        Optional<Employee> logist = findLogistForWarehouse(warehouse.get());

        if (logist.isEmpty()) {
            log.warn("No logist assigned to warehouse: id={}, abbreviation={}",
                warehouse.get().getId(), warehouse.get().getAbbreviation());
        } else {
            log.info("Found logist: {} for warehouse: {}",
                logist.get().getFullName(), warehouse.get().getAbbreviation());
        }

        return logist;
    }

    /**
     * –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤–æ–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ —Å–∫–ª–∞–¥–∞ –Ω–∞ –ª–æ–≥–∏—Å—Ç–∞
     */
    @Transactional
    public CourierWarehouseLogistAssignment createAssignment(
            UUID warehouseId,
            Long employeeId,
            Integer priority) {

        CourierWarehouse warehouse = warehouseRepository.findById(warehouseId)
            .orElseThrow(() -> new NotFoundException("Warehouse not found: " + warehouseId));

        Employee employee = employeeRepository.findById(employeeId)
            .orElseThrow(() -> new NotFoundException("Employee not found: " + employeeId));

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
        if (assignmentRepository.existsByWarehouse_IdAndLogistEmployee_IdAndIsActiveTrue(
                warehouseId, employeeId)) {
            throw new IllegalStateException(
                "Active assignment already exists for warehouse " + warehouse.getAbbreviation() +
                " and employee " + employee.getFullName()
            );
        }

        CourierWarehouseLogistAssignment assignment = new CourierWarehouseLogistAssignment();
        assignment.setWarehouse(warehouse);
        assignment.setLogistEmployee(employee);
        assignment.setPriority(priority != null ? priority : 1);
        assignment.setIsActive(true);

        assignment = assignmentRepository.save(assignment);

        log.info("Created warehouse-logist assignment: warehouse={}, logist={}, priority={}",
            warehouse.getAbbreviation(), employee.getFullName(), assignment.getPriority());

        return assignment;
    }

    /**
     * –û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è
     */
    @Transactional
    public CourierWarehouseLogistAssignment updateAssignmentPriority(
            Long assignmentId,
            Integer newPriority) {

        CourierWarehouseLogistAssignment assignment = assignmentRepository.findById(assignmentId)
            .orElseThrow(() -> new NotFoundException("Assignment not found: " + assignmentId));

        assignment.setPriority(newPriority);
        return assignmentRepository.save(assignment);
    }

    /**
     * –î–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ
     */
    @Transactional
    public void deactivateAssignment(Long assignmentId) {
        CourierWarehouseLogistAssignment assignment = assignmentRepository.findById(assignmentId)
            .orElseThrow(() -> new NotFoundException("Assignment not found: " + assignmentId));

        assignment.setIsActive(false);
        assignmentRepository.save(assignment);

        log.info("Deactivated warehouse-logist assignment: id={}", assignmentId);
    }

    /**
     * –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è —Å–∫–ª–∞–¥–∞
     */
    @Transactional(readOnly = true)
    public List<CourierWarehouseLogistAssignment> getAssignmentsByWarehouse(UUID warehouseId) {
        return assignmentRepository.findByWarehouse_IdAndIsActiveTrueOrderByPriorityAsc(warehouseId);
    }

    /**
     * –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ —Å–∫–ª–∞–¥—ã, –Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã–µ –Ω–∞ –ª–æ–≥–∏—Å—Ç–∞
     */
    @Transactional(readOnly = true)
    public List<CourierWarehouseLogistAssignment> getAssignmentsByLogist(Long employeeId) {
        return assignmentRepository.findByLogistEmployee_IdAndIsActiveTrue(employeeId);
    }
}
```

---

### –®–∞–≥ 5: Backend - DTO

**–§–∞–π–ª**: `src/main/java/kz/coube/backend/applications/dto/CourierWarehouseLogistAssignmentDto.java`

```java
package kz.coube.backend.applications.dto;

import lombok.AllArgsConstructor;
import lombok.Data;
import lombok.NoArgsConstructor;

import java.util.UUID;

@Data
@NoArgsConstructor
@AllArgsConstructor
public class CourierWarehouseLogistAssignmentDto {
    private Long id;
    private UUID warehouseId;
    private String warehouseAbbreviation;  // –ß–µ–ª–æ–≤–µ–∫–æ—á–∏—Ç–∞–µ–º–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Å–∫–ª–∞–¥–∞ (PET-55)
    private String warehouseName;
    private Long logistEmployeeId;
    private String logistEmployeeName;
    private Integer priority;
    private Boolean isActive;
}
```

**–§–∞–π–ª**: `src/main/java/kz/coube/backend/applications/dto/CreateWarehouseLogistAssignmentRequest.java`

```java
package kz.coube.backend.applications.dto;

import jakarta.validation.constraints.Min;
import jakarta.validation.constraints.NotNull;
import lombok.Data;

import java.util.UUID;

@Data
public class CreateWarehouseLogistAssignmentRequest {

    @NotNull(message = "Warehouse ID is required")
    private UUID warehouseId;

    @NotNull(message = "Employee ID is required")
    private Long employeeId;

    @Min(value = 1, message = "Priority must be at least 1")
    private Integer priority = 1;
}
```

---

### –®–∞–≥ 6: Backend - REST Controller

**–§–∞–π–ª**: `src/main/java/kz/coube/backend/applications/controller/CourierWarehouseLogistAssignmentController.java`

```java
package kz.coube.backend.applications.controller;

import io.swagger.v3.oas.annotations.Operation;
import io.swagger.v3.oas.annotations.tags.Tag;
import jakarta.validation.Valid;
import kz.coube.backend.applications.dto.CourierWarehouseLogistAssignmentDto;
import kz.coube.backend.applications.dto.CreateWarehouseLogistAssignmentRequest;
import kz.coube.backend.applications.entity.CourierWarehouseLogistAssignment;
import kz.coube.backend.applications.service.CourierWarehouseLogistAssignmentService;
import lombok.RequiredArgsConstructor;
import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.security.access.prepost.PreAuthorize;
import org.springframework.web.bind.annotation.*;

import java.util.List;
import java.util.UUID;
import java.util.stream.Collectors;

@RestController
@RequestMapping("/api/v1/courier/warehouse-logist-assignments")
@RequiredArgsConstructor
@Tag(name = "Warehouse Logist Assignment", description = "–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ–º –ª–æ–≥–∏—Å—Ç–æ–≤ –Ω–∞ —Å–∫–ª–∞–¥—ã")
public class CourierWarehouseLogistAssignmentController {

    private final CourierWarehouseLogistAssignmentService assignmentService;

    @Operation(summary = "–°–æ–∑–¥–∞—Ç—å –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ —Å–∫–ª–∞–¥–∞ –Ω–∞ –ª–æ–≥–∏—Å—Ç–∞")
    @PostMapping
    @PreAuthorize("hasAnyRole('ADMIN', 'CEO')")
    public ResponseEntity<CourierWarehouseLogistAssignmentDto> createAssignment(
            @Valid @RequestBody CreateWarehouseLogistAssignmentRequest request) {

        CourierWarehouseLogistAssignment assignment = assignmentService.createAssignment(
            request.getWarehouseId(),
            request.getEmployeeId(),
            request.getPriority()
        );

        return ResponseEntity.status(HttpStatus.CREATED)
            .body(toDto(assignment));
    }

    @Operation(summary = "–ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è —Å–∫–ª–∞–¥–∞")
    @GetMapping("/by-warehouse/{warehouseId}")
    @PreAuthorize("hasAnyRole('ADMIN', 'CEO', 'LOGISTICIAN')")
    public ResponseEntity<List<CourierWarehouseLogistAssignmentDto>> getAssignmentsByWarehouse(
            @PathVariable UUID warehouseId) {

        List<CourierWarehouseLogistAssignment> assignments =
            assignmentService.getAssignmentsByWarehouse(warehouseId);

        return ResponseEntity.ok(
            assignments.stream()
                .map(this::toDto)
                .collect(Collectors.toList())
        );
    }

    @Operation(summary = "–ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ —Å–∫–ª–∞–¥—ã, –Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã–µ –Ω–∞ –ª–æ–≥–∏—Å—Ç–∞")
    @GetMapping("/by-logist/{employeeId}")
    @PreAuthorize("hasAnyRole('ADMIN', 'CEO', 'LOGISTICIAN')")
    public ResponseEntity<List<CourierWarehouseLogistAssignmentDto>> getAssignmentsByLogist(
            @PathVariable Long employeeId) {

        List<CourierWarehouseLogistAssignment> assignments =
            assignmentService.getAssignmentsByLogist(employeeId);

        return ResponseEntity.ok(
            assignments.stream()
                .map(this::toDto)
                .collect(Collectors.toList())
        );
    }

    @Operation(summary = "–û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è")
    @PutMapping("/{id}/priority")
    @PreAuthorize("hasAnyRole('ADMIN', 'CEO')")
    public ResponseEntity<CourierWarehouseLogistAssignmentDto> updatePriority(
            @PathVariable Long id,
            @RequestParam Integer priority) {

        CourierWarehouseLogistAssignment assignment =
            assignmentService.updateAssignmentPriority(id, priority);

        return ResponseEntity.ok(toDto(assignment));
    }

    @Operation(summary = "–î–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ")
    @DeleteMapping("/{id}")
    @PreAuthorize("hasAnyRole('ADMIN', 'CEO')")
    public ResponseEntity<Void> deactivateAssignment(@PathVariable Long id) {
        assignmentService.deactivateAssignment(id);
        return ResponseEntity.noContent().build();
    }

    private CourierWarehouseLogistAssignmentDto toDto(CourierWarehouseLogistAssignment assignment) {
        return new CourierWarehouseLogistAssignmentDto(
            assignment.getId(),
            assignment.getWarehouse().getId(),
            assignment.getWarehouse().getAbbreviation(),
            assignment.getWarehouse().getName(),
            assignment.getLogistEmployee().getId(),
            assignment.getLogistEmployee().getFullName(),
            assignment.getPriority(),
            assignment.getIsActive()
        );
    }
}
```

---

### –®–∞–≥ 7: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ CourierIntegrationService

**–§–∞–π–ª**: `src/main/java/kz/coube/backend/courier/service/CourierIntegrationService.java`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –º–µ—Ç–æ–¥–µ `importWaybill`**:

```java
@Service
@RequiredArgsConstructor
@Slf4j
public class CourierIntegrationService {

    private final CourierWarehouseLogistAssignmentService warehouseAssignmentService;
    // ... –¥—Ä—É–≥–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

    @Transactional
    public WaybillImportResponse importWaybill(WaybillImportRequest request) {

        log.info("Importing waybill from TEEZ: id={}, sourceSystem={}",
            request.waybill().id(), request.sourceSystem());

        // 1. –í–∞–ª–∏–¥–∞—Ü–∏—è
        validateWaybillRequest(request);

        // 2. ‚≠ê NEW: –ù–∞–π—Ç–∏ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –ª–æ–≥–∏—Å—Ç–∞ TEEZ –¥–ª—è —Å–∫–ª–∞–¥–∞
        Employee contactLogist = findContactLogistForWaybill(request);

        if (contactLogist == null) {
            // ‚ö†Ô∏è –°—Ç—Ä–æ–≥–∏–π —Ä–µ–∂–∏–º: –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –∏–º–ø–æ—Ä—Ç –µ—Å–ª–∏ –ª–æ–≥–∏—Å—Ç –Ω–µ –Ω–∞–∑–Ω–∞—á–µ–Ω
            throw new ValidationException(
                "No logist assigned to warehouse. " +
                "Please configure warehouse-logist assignment first."
            );

            // üîß –ú—è–≥–∫–∏–π —Ä–µ–∂–∏–º (–¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è): –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –±–µ–∑ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è
            // log.warn("No logist assigned to warehouse. " +
            //     "Transportation will be created without contact employee.");
        }

        // 3. –°–æ–∑–¥–∞—Ç—å Transportation
        Transportation transportation = createTransportation(request);

        // ‚≠ê NEW: –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å contactEmployee (–ª–æ–≥–∏—Å—Ç TEEZ)
        if (contactLogist != null) {
            transportation.setContactEmployee(contactLogist);
            log.info("Assigned contact logist: {} for transportation",
                contactLogist.getFullName());
        }

        // 4. –°–æ–∑–¥–∞—Ç—å cargo loadings, orders, etc.
        // ...

        // 5. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
        transportation = transportationRepository.save(transportation);

        log.info("Waybill imported successfully: transportationId={}, contactLogist={}",
            transportation.getId(),
            contactLogist != null ? contactLogist.getFullName() : "NONE");

        return new WaybillImportResponse(
            transportation.getId(),
            "SUCCESS",
            contactLogist != null ? contactLogist.getFullName() : null
        );
    }

    /**
     * ‚≠ê NEW: –ù–∞–π—Ç–∏ –∫–æ–Ω—Ç–∞–∫—Ç–Ω–æ–≥–æ –ª–æ–≥–∏—Å—Ç–∞ TEEZ –¥–ª—è –º–∞—Ä—à—Ä—É—Ç–Ω–æ–≥–æ –ª–∏—Å—Ç–∞
     */
    private Employee findContactLogistForWaybill(WaybillImportRequest request) {

        // –ù–∞–π—Ç–∏ —Ç–æ—á–∫—É —Å warehouseId (—Å–∫–ª–∞–¥ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è TEEZ)
        Optional<DeliveryPoint> warehousePoint = request.deliveries().stream()
            .filter(p -> Boolean.TRUE.equals(p.isCourierWarehouse()) && p.warehouseId() != null)
            .findFirst();

        if (warehousePoint.isEmpty()) {
            log.warn("No warehouse delivery point found in waybill");
            return null;
        }

        String warehouseId = warehousePoint.get().warehouseId();
        String sourceSystem = String.valueOf(request.sourceSystem());

        return warehouseAssignmentService
            .findLogistByPartnerWarehouseId(warehouseId, sourceSystem)
            .orElse(null);
    }
}
```

---

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ (First-time setup)

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ß–µ—Ä–µ–∑ SQL (–±—ã—Å—Ç—Ä–µ–µ)

```sql
-- –ü—Ä–∏–º–µ—Ä: –ù–∞–∑–Ω–∞—á–∏—Ç—å —Å–∫–ª–∞–¥ "PET-55" –Ω–∞ –ª–æ–≥–∏—Å—Ç–∞ –ê–ª–∏—à–µ—Ä–∞

-- 1. –ù–∞–π—Ç–∏ ID —Å–∫–ª–∞–¥–∞ –ø–æ abbreviation
SELECT id, abbreviation, name, partner_warehouse_id
FROM applications.courier_warehouse
WHERE abbreviation = 'PET-55' AND is_active = TRUE;
-- –†–µ–∑—É–ª—å—Ç–∞—Ç: id = 'a1b2c3d4-...'

-- 2. –ù–∞–π—Ç–∏ ID –ª–æ–≥–∏—Å—Ç–∞ TEEZ
SELECT e.id, e.first_name, e.last_name, u.username
FROM users.employee e
JOIN users.user u ON e.user_id = u.id
WHERE u.username = 'alisher.logist';
-- –†–µ–∑—É–ª—å—Ç–∞—Ç: id = 123

-- 3. –°–æ–∑–¥–∞—Ç—å –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ
INSERT INTO applications.courier_warehouse_logist_assignment
    (warehouse_id, logist_employee_id, priority, is_active, created_at, created_by)
VALUES
    ('a1b2c3d4-...', 123, 1, TRUE, NOW(), 'SYSTEM_SETUP');
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ß–µ—Ä–µ–∑ REST API (–¥–ª—è UI)

```bash
# 1. –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ —Å–∫–ª–∞–¥–æ–≤ TEEZ
GET /api/v1/courier/warehouses
Response:
[
  {
    "id": "a1b2c3d4-...",
    "abbreviation": "PET-55",
    "name": "–ö—É—Ä—å–µ—Ä—Å–∫–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞ –ü–µ—Ç—Ä–æ–ø–∞–≤–ª–æ–≤—Å–∫",
    "partnerWarehouseId": 58
  }
]

# 2. –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –ª–æ–≥–∏—Å—Ç–æ–≤ TEEZ
GET /api/v1/employees?role=LOGISTICIAN
Response:
[
  {
    "id": 123,
    "fullName": "–ê–ª–∏—à–µ—Ä –ù—É—Ä–ª–∞–Ω–æ–≤",
    "username": "alisher.logist"
  }
]

# 3. –°–æ–∑–¥–∞—Ç—å –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ —Å–∫–ª–∞–¥–∞ –Ω–∞ –ª–æ–≥–∏—Å—Ç–∞
POST /api/v1/courier/warehouse-logist-assignments
{
  "warehouseId": "a1b2c3d4-...",
  "employeeId": 123,
  "priority": 1
}

Response: 201 Created
{
  "id": 1,
  "warehouseId": "a1b2c3d4-...",
  "warehouseAbbreviation": "PET-55",
  "warehouseName": "–ö—É—Ä—å–µ—Ä—Å–∫–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞ –ü–µ—Ç—Ä–æ–ø–∞–≤–ª–æ–≤—Å–∫",
  "logistEmployeeId": 123,
  "logistEmployeeName": "–ê–ª–∏—à–µ—Ä –ù—É—Ä–ª–∞–Ω–æ–≤",
  "priority": 1,
  "isActive": true
}
```

---

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### 1. Unit —Ç–µ—Å—Ç—ã

**–§–∞–π–ª**: `CourierWarehouseLogistAssignmentServiceTest.java`

```java
@Test
void findLogistForWarehouse_shouldReturnEmployeeWithHighestPriority() {
    // Given
    CourierWarehouse warehouse = createWarehouse("PET-55");
    Employee logist1 = createEmployee("–ê–ª–∏—à–µ—Ä", 123L);
    Employee logist2 = createEmployee("–ê—Å–µ–ª—å", 456L);

    createAssignment(warehouse, logist1, priority: 2);  // –ù–∏–∑–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç
    createAssignment(warehouse, logist2, priority: 1);  // –í—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç

    // When
    Optional<Employee> result = assignmentService.findLogistForWarehouse(warehouse);

    // Then
    assertTrue(result.isPresent());
    assertEquals("–ê—Å–µ–ª—å", result.get().getFirstName());
}

@Test
void findLogistByPartnerWarehouseId_shouldFindCorrectLogist() {
    // Given
    CourierWarehouse warehouse = createWarehouse("PET-55", partnerId: 58);
    Employee logist = createEmployee("–ê–ª–∏—à–µ—Ä", 123L);
    createAssignment(warehouse, logist, priority: 1);

    // When
    Optional<Employee> result = assignmentService
        .findLogistByPartnerWarehouseId("58", "TEEZ_PVZ");

    // Then
    assertTrue(result.isPresent());
    assertEquals("–ê–ª–∏—à–µ—Ä", result.get().getFirstName());
}
```

### 2. Integration —Ç–µ—Å—Ç –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞

**–§–∞–π–ª**: `CourierIntegrationServiceTest.java`

```java
@Test
void importWaybill_shouldAssignContactEmployee() {
    // Given
    CourierWarehouse warehouse = createWarehouse(partnerId: 58);
    Employee logist = createEmployee("–ê–ª–∏—à–µ—Ä");
    createAssignment(warehouse, logist);

    WaybillImportRequest request = createWaybillRequest(warehouseId: "58");

    // When
    WaybillImportResponse response = courierIntegrationService.importWaybill(request);

    // Then
    assertEquals("SUCCESS", response.getStatus());

    Transportation transportation = transportationRepository
        .findById(response.getTransportationId()).get();

    assertNotNull(transportation.getContactEmployee());
    assertEquals("–ê–ª–∏—à–µ—Ä", transportation.getContactEmployee().getFirstName());
}

@Test
void importWaybill_noLogistAssigned_shouldThrowException() {
    // Given
    CourierWarehouse warehouse = createWarehouse(partnerId: 58);
    // –ù–ï —Å–æ–∑–¥–∞–µ–º –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ –ª–æ–≥–∏—Å—Ç–∞

    WaybillImportRequest request = createWaybillRequest(warehouseId: "58");

    // When & Then
    assertThrows(ValidationException.class, () -> {
        courierIntegrationService.importWaybill(request);
    });
}
```

### 3. REST API —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# 1. –°–æ–∑–¥–∞—Ç—å –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ
POST /api/v1/courier/warehouse-logist-assignments
{
  "warehouseId": "a1b2c3d4-...",
  "employeeId": 123,
  "priority": 1
}
# –û–∂–∏–¥–∞–µ—Ç—Å—è: 201 Created

# 2. –ü–æ–ª—É—á–∏—Ç—å –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è —Å–∫–ª–∞–¥–∞
GET /api/v1/courier/warehouse-logist-assignments/by-warehouse/a1b2c3d4-...
# –û–∂–∏–¥–∞–µ—Ç—Å—è: –°–ø–∏—Å–æ–∫ –ª–æ–≥–∏—Å—Ç–æ–≤ –¥–ª—è —ç—Ç–æ–≥–æ —Å–∫–ª–∞–¥–∞

# 3. –ü–æ–ª—É—á–∏—Ç—å —Å–∫–ª–∞–¥—ã –¥–ª—è –ª–æ–≥–∏—Å—Ç–∞
GET /api/v1/courier/warehouse-logist-assignments/by-logist/123
# –û–∂–∏–¥–∞–µ—Ç—Å—è: –°–ø–∏—Å–æ–∫ —Å–∫–ª–∞–¥–æ–≤, –Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã—Ö –Ω–∞ —ç—Ç–æ–≥–æ –ª–æ–≥–∏—Å—Ç–∞

# 4. –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –º–∞—Ä—à—Ä—É—Ç –æ—Ç TEEZ –∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ
POST /api/v1/integration/waybills
{
  "waybill": {
    "id": "WB-TEST-001",
    ...
  },
  "deliveries": [
    {
      "isCourierWarehouse": true,
      "warehouseId": "58",  # partner_warehouse_id
      ...
    }
  ]
}

# 5. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ Transportation —Å–æ–∑–¥–∞–Ω —Å contactEmployee
GET /api/v1/customer/transportations/{transportationId}
Response:
{
  "id": 1001,
  "contactEmployee": {
    "id": 123,
    "fullName": "–ê–ª–∏—à–µ—Ä –ù—É—Ä–ª–∞–Ω–æ–≤"
  },
  ...
}
```

---

## Checklist –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

### Phase 1: Backend Core
- [ ] –ú–∏–≥—Ä–∞—Ü–∏—è: –°–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É `courier_warehouse_logist_assignment`
- [ ] Entity: `CourierWarehouseLogistAssignment`
- [ ] Repository: `CourierWarehouseLogistAssignmentRepository`
- [ ] Service: `CourierWarehouseLogistAssignmentService`
- [ ] DTO: Request/Response –∫–ª–∞—Å—Å—ã

### Phase 2: REST API
- [ ] Controller: CRUD endpoints –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è–º–∏
- [ ] Swagger –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –¥–ª—è endpoints
- [ ] –¢–µ—Å—Ç—ã –¥–ª—è REST API

### Phase 3: Integration
- [ ] –û–±–Ω–æ–≤–∏—Ç—å `CourierIntegrationService.importWaybill()`
- [ ] –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥ `findContactLogistForWaybill()`
- [ ] –¢–µ—Å—Ç—ã –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞ —Å –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ–º

### Phase 4: Testing
- [ ] Unit —Ç–µ—Å—Ç—ã –¥–ª—è Service
- [ ] Integration —Ç–µ—Å—Ç—ã –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞
- [ ] REST API —Ç–µ—Å—Ç—ã
- [ ] –†—É—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ dev/stage

---

## Estimated Time

**Backend Core**: 1.5 –¥–Ω—è
- –ú–∏–≥—Ä–∞—Ü–∏—è: 30 –º–∏–Ω
- Entity + Repository: 2 —á–∞—Å–∞
- Service: 3 —á–∞—Å–∞
- DTO: 1 —á–∞—Å

**REST API**: 1 –¥–µ–Ω—å
- Controller: 2 —á–∞—Å–∞
- Swagger docs: 1 —á–∞—Å
- REST —Ç–µ—Å—Ç—ã: 2 —á–∞—Å–∞

**Integration**: 0.5 –¥–Ω—è
- CourierIntegrationService: 2 —á–∞—Å–∞
- Integration —Ç–µ—Å—Ç—ã: 2 —á–∞—Å–∞

**Testing & Fixes**: 0.5 –¥–Ω—è

**–ò—Ç–æ–≥–æ**: 3-4 –¥–Ω—è

---

## –†–∏—Å–∫–∏ –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

### –†–∏—Å–∫ 1: –ò–º–ø–æ—Ä—Ç –±–µ–∑ –Ω–∞–∑–Ω–∞—á–µ–Ω–Ω–æ–≥–æ –ª–æ–≥–∏—Å—Ç–∞
**–ü—Ä–æ–±–ª–µ–º–∞**: –ß—Ç–æ –¥–µ–ª–∞—Ç—å –µ—Å–ª–∏ —Å–∫–ª–∞–¥ –Ω–µ –ø—Ä–∏–≤—è–∑–∞–Ω –∫ –ª–æ–≥–∏—Å—Ç—É?

**–†–µ—à–µ–Ω–∏–µ**:
- –°—Ç—Ä–æ–≥–∏–π —Ä–µ–∂–∏–º (production): –ë–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –∏–º–ø–æ—Ä—Ç —Å ValidationException
- –ú—è–≥–∫–∏–π —Ä–µ–∂–∏–º (dev/testing): –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å —Å `contactEmployee = null`

### –†–∏—Å–∫ 2: –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ª–æ–≥–∏—Å—Ç—ã –Ω–∞ –æ–¥–∏–Ω —Å–∫–ª–∞–¥
**–ü—Ä–æ–±–ª–µ–º–∞**: –ö–∞–∫ –≤—ã–±—Ä–∞—Ç—å –º–µ–∂–¥—É –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –ª–æ–≥–∏—Å—Ç–∞–º–∏?

**–†–µ—à–µ–Ω–∏–µ**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–æ–ª–µ `priority` (1 = –≤—ã—Å—à–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)

### –†–∏—Å–∫ 3: –£–¥–∞–ª–µ–Ω–∏–µ –ª–æ–≥–∏—Å—Ç–∞
**–ü—Ä–æ–±–ª–µ–º–∞**: –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Å –∑–∞—è–≤–∫–∞–º–∏ –µ—Å–ª–∏ –ª–æ–≥–∏—Å—Ç —É–¥–∞–ª–µ–Ω?

**–†–µ—à–µ–Ω–∏–µ**: `ON DELETE CASCADE` –≤ mapping —Ç–∞–±–ª–∏—Ü–µ. –í Transportation –ø–æ–ª–µ `contact_employee_id` –∏–º–µ–µ—Ç `ON DELETE SET NULL` - –∑–∞—è–≤–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è, —Ç–æ–ª—å–∫–æ —Å–Ω–∏–º–∞–µ—Ç—Å—è –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ

---

## –ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö

```
TEEZ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç waybill
  warehouseId: "58"
      ‚Üì
Backend: CourierIntegrationService.importWaybill()
      ‚Üì
–ù–∞—Ö–æ–¥–∏—Ç warehouse –ø–æ partner_warehouse_id = 58
  (abbreviation = "PET-55")
      ‚Üì
–ò—â–µ—Ç –≤ courier_warehouse_logist_assignment:
  warehouse_id = ... ‚Üí logist_employee_id = 123
      ‚Üì
–ù–∞—Ö–æ–¥–∏—Ç Employee —Å id = 123 (–ê–ª–∏—à–µ—Ä –ù—É—Ä–ª–∞–Ω–æ–≤)
      ‚Üì
–°–æ–∑–¥–∞–µ—Ç Transportation:
  contactEmployee = –ê–ª–∏—à–µ—Ä –ù—É—Ä–ª–∞–Ω–æ–≤
  createdBy = "SYSTEM_IMPORT"
      ‚Üì
–õ–æ–≥–∏—Å—Ç –ê–ª–∏—à–µ—Ä –≤–∏–¥–∏—Ç –∑–∞—è–≤–∫—É (—Ñ–∏–ª—å—Ç—Ä –ø–æ contactEmployee)
```

---

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: HIGH
**–°—Ç–∞—Ç—É—Å**: Ready for development
**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**: –¢—Ä–µ–±—É–µ—Ç –Ω–∞–ª–∏—á–∏—è —Ç–∞–±–ª–∏—Ü `courier_warehouse` –∏ `employee`
