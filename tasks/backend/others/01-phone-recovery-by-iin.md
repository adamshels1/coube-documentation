# 01. –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –ø–æ –ò–ò–ù (–∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ —Ç–µ–ª–µ—Ñ–æ–Ω—É)

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è**: 2025-12-18
**–°—Ç–∞—Ç—É—Å**: TO DO
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: HIGH
**–ê–≤—Ç–æ—Ä**: Ali

---

## üìã –ü—Ä–æ–±–ª–µ–º–∞

**–ë–∏–∑–Ω–µ—Å-–∫–µ–π—Å:**
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –∑–∞–±—ã–≤–∞—é—Ç —Å–≤–æ–π –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –∏ –Ω–µ –º–æ–≥—É—Ç –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è –≤ —Å–∏—Å—Ç–µ–º–µ.

**–¢–µ–∫—É—â–∞—è —Å–∏—Ç—É–∞—Ü–∏—è:**
- ‚úÖ –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ + –°–ú–° –∫–æ–¥
- ‚ùå –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–±—ã–ª –Ω–æ–º–µ—Ä - –¥–æ—Å—Ç—É–ø –∫ —Å–∏—Å—Ç–µ–º–µ –Ω–µ–≤–æ–∑–º–æ–∂–µ–Ω
- ‚ùå –ù–µ—Ç –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ–≥–æ —Å–ø–æ—Å–æ–±–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

**–†–µ—à–µ–Ω–∏–µ:**
–î–æ–±–∞–≤–∏—Ç—å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é –ø–æ –ò–ò–ù –∫–∞–∫ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—É —Ç–µ–ª–µ—Ñ–æ–Ω—É:
1. –ù–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –ª–æ–≥–∏–Ω–∞: –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å "–í–æ–π—Ç–∏ –ø–æ —Ç–µ–ª–µ—Ñ–æ–Ω—É" / "–í–æ–π—Ç–∏ –ø–æ –ò–ò–ù"
2. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç –ò–ò–ù
3. –°–∏—Å—Ç–µ–º–∞ –Ω–∞—Ö–æ–¥–∏—Ç —Ç–µ–ª–µ—Ñ–æ–Ω –ø–æ –ò–ò–ù
4. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –°–ú–° –∫–æ–¥ –Ω–∞ —ç—Ç–æ—Ç —Ç–µ–ª–µ—Ñ–æ–Ω (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
5. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç –°–ú–° –∫–æ–¥ ‚Üí –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω

**–í–∞–∂–Ω–æ:** –°–∞–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –≤–∏–¥–∏—Ç —Å–≤–æ–π –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞, –ø—Ä–æ—Å—Ç–æ –≤–≤–æ–¥–∏—Ç –ò–ò–ù –∏ –ø–æ–ª—É—á–∞–µ—Ç –°–ú–°.

---

## üéØ –†–µ—à–µ–Ω–∏–µ

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Login Page     ‚îÇ
‚îÇ  [–¢–µ–ª–µ—Ñ–æ–Ω|–ò–ò–ù]  ‚îÇ  <-- –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
         ‚îÇ –í–∞—Ä–∏–∞–Ω—Ç 1: POST /auth/send-otp (phone)
         ‚îÇ –í–∞—Ä–∏–∞–Ω—Ç 2: POST /auth/send-otp-by-iin (iin)
         ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Backend        ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ>‚îÇ WhatsApp SMS ‚îÇ
‚îÇ  (–Ω–∞–π—Ç–∏ phone)  ‚îÇ  –∫–æ–¥    ‚îÇ  –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
         ‚îÇ success (–∫–æ–¥ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω)
         ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  OTP Page       ‚îÇ
‚îÇ  (–≤–≤–æ–¥ –°–ú–°)     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
         ‚îÇ POST /auth/verify-otp (phone + code)
         ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Authorized     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üóÑÔ∏è –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –ë–î

**–ù–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è** - –∏—Å–ø–æ–ª—å–∑—É–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é —Ç–∞–±–ª–∏—Ü—É `organization.employee` —Å –ø–æ–ª–µ–º `iin`

### –õ–æ–≥–∏–∫–∞ –ø–æ–∏—Å–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ –ò–ò–ù

1. –ü–æ–∏—Å–∫ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ –≤ `employee` –ø–æ –ø–æ–ª—é `iin`
2. –ü–æ–ª—É—á–∏—Ç—å –µ–≥–æ —Ç–µ–ª–µ—Ñ–æ–Ω (`phone`)
3. –û—Ç–ø—Ä–∞–≤–∏—Ç—å –°–ú–° –∫–æ–¥ –Ω–∞ —ç—Ç–æ—Ç —Ç–µ–ª–µ—Ñ–æ–Ω

**–ü—Ä–æ—Å—Ç–æ:** –æ–¥–∏–Ω –ò–ò–ù = –æ–¥–∏–Ω —á–µ–ª–æ–≤–µ–∫ = –æ–¥–∏–Ω —Ç–µ–ª–µ—Ñ–æ–Ω = –æ–¥–∏–Ω –°–ú–° –∫–æ–¥

---

## üîß Backend –∏–∑–º–µ–Ω–µ–Ω–∏—è

### 1. DTO: Request –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –ø–æ –ò–ò–ù

**File:** `coube-backend/src/main/java/kz/coube/backend/auth/dto/SendOtpByIinRequest.java`

```java
package kz.coube.backend.auth.dto;

import jakarta.validation.constraints.NotBlank;
import jakarta.validation.constraints.Pattern;
import jakarta.validation.constraints.Size;
import lombok.Data;

@Data
public class SendOtpByIinRequest {

    @NotBlank(message = "–ò–ò–ù –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º")
    @Size(min = 12, max = 12, message = "–ò–ò–ù –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å 12 —Ü–∏—Ñ—Ä")
    @Pattern(regexp = "^\\d{12}$", message = "–ò–ò–ù –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Ç–æ–ª—å–∫–æ —Ü–∏—Ñ—Ä—ã")
    private String iin;
}
```

---

### 2. DTO: Response (–ø—Ä–æ—Å—Ç–æ–π)

**File:** `coube-backend/src/main/java/kz/coube/backend/auth/dto/SendOtpResponse.java`

```java
package kz.coube.backend.auth.dto;

import lombok.Builder;

@Builder
public record SendOtpResponse(
    boolean success,
    String message  // "–°–ú–° –∫–æ–¥ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω"
) {}
```

---

### 3. Service: –ü—Ä–æ—Å—Ç–∞—è –ª–æ–≥–∏–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ OTP –ø–æ –ò–ò–ù

**File:** `coube-backend/src/main/java/kz/coube/backend/auth/service/AuthService.java`

–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π –º–µ—Ç–æ–¥ –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π `AuthService`:

```java
/**
 * –û—Ç–ø—Ä–∞–≤–∏—Ç—å OTP –∫–æ–¥ –ø–æ –ò–ò–ù (–Ω–∞–π—Ç–∏ —Ç–µ–ª–µ—Ñ–æ–Ω –ø–æ –ò–ò–ù –∏ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –°–ú–°)
 */
@Transactional
public SendOtpResponse sendOtpByIin(SendOtpByIinRequest request) {
    String iin = request.getIin();
    log.info("Sending OTP by IIN: {}", maskIin(iin));

    // 1. –ù–∞–π—Ç–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ –ø–æ –ò–ò–ù
    Employee employee = employeeRepository.findByIin(iin)
        .orElseThrow(() -> {
            log.warn("Employee not found for IIN: {}", maskIin(iin));
            return new ResourceNotFoundException(
                "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å —É–∫–∞–∑–∞–Ω–Ω—ã–º –ò–ò–ù –Ω–µ –Ω–∞–π–¥–µ–Ω"
            );
        });

    // 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ —É —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ –µ—Å—Ç—å —Ç–µ–ª–µ—Ñ–æ–Ω
    String phone = employee.getPhone();
    if (phone == null || phone.isBlank()) {
        log.warn("Employee has no phone. IIN: {}", maskIin(iin));
        throw new BusinessException(
            "–£ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–µ —É–∫–∞–∑–∞–Ω –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ –ø–æ–¥–¥–µ—Ä–∂–∫—É."
        );
    }

    // 3. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏ –æ—Ç–ø—Ä–∞–≤–∫–∞ –°–ú–° –∫–æ–¥–∞ (–∏—Å–ø–æ–ª—å–∑—É–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –º–µ—Ö–∞–Ω–∏–∑–º)
    String smsCode = otpDelegate.generate(new OtpId(phone));
    log.info("SMS code generated for IIN: {}. Phone: {}", maskIin(iin), maskPhone(phone));

    // –û—Ç–ø—Ä–∞–≤–∫–∞ –°–ú–° —á–µ—Ä–µ–∑ WhatsApp
    WhatsAppSendRequest whatsAppRequest = WhatsAppSendRequest.builder()
        .phone(phone)
        .template(WhatsAppTemplate.LOGIN_CODE_MSG)
        .language("ru")
        .bodyParams(List.of(smsCode))
        .buttonParam(smsCode)
        .build();

    whatsAppSenderService.sendTemplate(whatsAppRequest);
    log.info("SMS code sent to phone: {}", maskPhone(phone));

    return SendOtpResponse.builder()
        .success(true)
        .message("–°–ú–° –∫–æ–¥ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω")
        .build();
}

private String maskIin(String iin) {
    if (iin == null || iin.length() != 12) return "***";
    return iin.substring(0, 6) + "***" + iin.substring(9);
}

private String maskPhone(String phone) {
    if (phone == null || phone.length() < 11) return "***";
    return phone.substring(0, 5) + "***" + phone.substring(phone.length() - 2);
}
```

---

### 4. Repository: –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥ –ø–æ–∏—Å–∫–∞ –ø–æ –ò–ò–ù

**File:** `coube-backend/src/main/java/kz/coube/backend/organization/repository/EmployeeRepository.java`

```java
@Repository
public interface EmployeeRepository extends JpaRepository<Employee, Long> {

    // ... existing methods

    /**
     * –ù–∞–π—Ç–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ –ø–æ –ò–ò–ù
     */
    Optional<Employee> findByIin(String iin);
}
```

---

### 5. Controller: –î–æ–±–∞–≤–∏—Ç—å endpoint –≤ AuthController

**File:** `coube-backend/src/main/java/kz/coube/backend/auth/api/AuthController.java`

–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π endpoint –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π `AuthController`:

```java
@PostMapping("/send-otp-by-iin")
@Operation(
    summary = "–û—Ç–ø—Ä–∞–≤–∏—Ç—å OTP –∫–æ–¥ –ø–æ –ò–ò–ù",
    description = "–ü—É–±–ª–∏—á–Ω—ã–π endpoint. –ù–∞—Ö–æ–¥–∏—Ç —Ç–µ–ª–µ—Ñ–æ–Ω –ø–æ –ò–ò–ù –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –°–ú–° –∫–æ–¥."
)
public ResponseEntity<SendOtpResponse> sendOtpByIin(
    @Valid @RequestBody SendOtpByIinRequest request
) {
    log.info("Send OTP by IIN request");
    SendOtpResponse response = authService.sendOtpByIin(request);
    return ResponseEntity.ok(response);
}
```

---

### 6. Security: Rate Limiting –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç –±—Ä—É—Ç—Ñ–æ—Ä—Å–∞

**–í–∞–∂–Ω–æ**: –î–æ–±–∞–≤–∏—Ç—å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –Ω–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ø—ã—Ç–æ–∫ —Å –æ–¥–Ω–æ–≥–æ IP.

**File:** `coube-backend/src/main/java/kz/coube/backend/config/WebMvcConfig.java`

```java
@Override
public void addInterceptors(InterceptorRegistry registry) {
    registry.addInterceptor(rateLimitInterceptor)
        .addPathPatterns("/api/v1/public/**")
        .addPathPatterns("/api/v1/auth/send-otp-by-iin");  // ‚≠ê NEW
}
```

**Rate Limit**: 5 –ø–æ–ø—ã—Ç–æ–∫ –≤ 15 –º–∏–Ω—É—Ç –Ω–∞ IP –∞–¥—Ä–µ—Å

---

## üìä API Examples

### Request: –û—Ç–ø—Ä–∞–≤–∏—Ç—å OTP –ø–æ –ò–ò–ù

```http
POST /api/v1/auth/send-otp-by-iin
Content-Type: application/json

{
  "iin": "123456789012"
}
```

### Response: –£—Å–ø–µ—à–Ω–æ (200)

```json
{
  "success": true,
  "message": "–°–ú–° –∫–æ–¥ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω"
}
```

### Response: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω (404)

```json
{
  "error": "ResourceNotFoundException",
  "message": "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å —É–∫–∞–∑–∞–Ω–Ω—ã–º –ò–ò–ù –Ω–µ –Ω–∞–π–¥–µ–Ω",
  "timestamp": "2025-12-18T10:30:00Z"
}
```

### Response: –ù–µ—Ç —Ç–µ–ª–µ—Ñ–æ–Ω–∞ (400)

```json
{
  "error": "BusinessException",
  "message": "–£ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–µ —É–∫–∞–∑–∞–Ω –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ –ø–æ–¥–¥–µ—Ä–∂–∫—É.",
  "timestamp": "2025-12-18T10:30:00Z"
}
```

### Response: Rate Limit (429)

```json
{
  "error": "TooManyRequests",
  "message": "–°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –ø–æ–ø—ã—Ç–æ–∫. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —á–µ—Ä–µ–∑ 15 –º–∏–Ω—É—Ç.",
  "timestamp": "2025-12-18T10:30:00Z"
}
```

---

## üîÑ –§–ª–æ—É –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

### –ü–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏ OTP

–î–∞–ª—å—à–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π** endpoint –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–æ–¥–∞:

```http
POST /api/v1/auth/verify-otp
Content-Type: application/json

{
  "phone": "phone_from_iin",  // Frontend –ù–ï –∑–Ω–∞–µ—Ç phone
  "code": "123456"
}
```

**–ü—Ä–æ–±–ª–µ–º–∞**: Frontend –Ω–µ –∑–Ω–∞–µ—Ç phone –ø–æ—Å–ª–µ –≤–≤–æ–¥–∞ –ò–ò–ù.

**–†–µ—à–µ–Ω–∏–µ 1** (–ø—Ä–æ—Å—Ç–æ–µ): Backend –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç phone –≤ response `send-otp-by-iin`:
```json
{
  "success": true,
  "message": "–°–ú–° –∫–æ–¥ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω",
  "phone": "+77012345678"  // ‚≠ê –¥–æ–±–∞–≤–∏—Ç—å
}
```

**–†–µ—à–µ–Ω–∏–µ 2** (–±–µ–∑–æ–ø–∞—Å–Ω–µ–µ): –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ò–ò–ù ‚Üí phone –º–∞–ø–ø–∏–Ω–≥ –≤ —Å–µ—Å—Å–∏–∏/–∫–µ—à–µ –Ω–∞ 5 –º–∏–Ω—É—Ç,
—Å–æ–∑–¥–∞—Ç—å endpoint `/auth/verify-otp-by-iin`:
```http
POST /api/v1/auth/verify-otp-by-iin
{
  "iin": "123456789012",
  "code": "123456"
}
```
Backend —Å–∞–º –Ω–∞–π–¥–µ—Ç phone –ø–æ –ò–ò–ù –∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç –∫–æ–¥.

---

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### 1. Rate Limiting
- **–õ–∏–º–∏—Ç**: 5 –ø–æ–ø—ã—Ç–æ–∫ –≤ 15 –º–∏–Ω—É—Ç –Ω–∞ IP –∞–¥—Ä–µ—Å
- **–¶–µ–ª—å**: –ó–∞—â–∏—Ç–∞ –æ—Ç –±—Ä—É—Ç—Ñ–æ—Ä—Å–∞ –ò–ò–ù

### 2. –ú–∞—Å–∫–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –ª–æ–≥–∞—Ö
- **–ò–ò–ù –≤ –ª–æ–≥–∞—Ö**: `123456***012` (—Å–∫—Ä—ã—Ç—ã 3 —Ü–∏—Ñ—Ä—ã –ø–æ—Å–µ—Ä–µ–¥–∏–Ω–µ)
- **–¢–µ–ª–µ—Ñ–æ–Ω –≤ –ª–æ–≥–∞—Ö**: `+7701***67` (—Å–∫—Ä—ã—Ç—ã —Å—Ä–µ–¥–Ω–∏–µ —Ü–∏—Ñ—Ä—ã)

### 3. –í–∞–ª–∏–¥–∞—Ü–∏—è
- –ò–ò–ù –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Ä–æ–≤–Ω–æ 12 —Ü–∏—Ñ—Ä
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∞ (—Ç–æ–ª—å–∫–æ —Ü–∏—Ñ—Ä—ã)

---

## üß™ Testing Checklist

### Unit Tests
- [ ] `AuthService.sendOtpByIin()` - —É—Å–ø–µ—à–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞
- [ ] –°–æ—Ç—Ä—É–¥–Ω–∏–∫ –Ω–µ –Ω–∞–π–¥–µ–Ω ‚Üí `ResourceNotFoundException`
- [ ] –°–æ—Ç—Ä—É–¥–Ω–∏–∫ –±–µ–∑ —Ç–µ–ª–µ—Ñ–æ–Ω–∞ ‚Üí `BusinessException`
- [ ] –í–∞–ª–∏–¥–∞—Ü–∏—è –ò–ò–ù (12 —Ü–∏—Ñ—Ä, —Ç–æ–ª—å–∫–æ —Ü–∏—Ñ—Ä—ã)
- [ ] –ú–∞—Å–∫–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –ª–æ–≥–∞—Ö —Ä–∞–±–æ—Ç–∞–µ—Ç

### Integration Tests
- [ ] POST `/api/v1/auth/send-otp-by-iin` - —É—Å–ø–µ—à–Ω—ã–π –∑–∞–ø—Ä–æ—Å
- [ ] POST —Å –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–º –ò–ò–ù ‚Üí 400 Bad Request
- [ ] POST —Å –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º –ò–ò–ù ‚Üí 404 Not Found
- [ ] Rate limiting —Ä–∞–±–æ—Ç–∞–µ—Ç (6-–π –∑–∞–ø—Ä–æ—Å ‚Üí 429)

### E2E Tests
- [ ] –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç –ò–ò–ù ‚Üí –ø–æ–ª—É—á–∞–µ—Ç –°–ú–° ‚Üí –≤–≤–æ–¥–∏—Ç –∫–æ–¥ ‚Üí –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω

---

## üìù –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å

### Backend (5 –∏–∑–º–µ–Ω–µ–Ω–∏–π)

1. ‚ùå `SendOtpByIinRequest.java` - DTO –¥–ª—è –∑–∞–ø—Ä–æ—Å–∞
2. ‚ùå `SendOtpResponse.java` - DTO –¥–ª—è –æ—Ç–≤–µ—Ç–∞ (–µ—Å–ª–∏ –Ω–µ—Ç)
3. ‚ùå `AuthService.sendOtpByIin()` - –º–µ—Ç–æ–¥ –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–º —Å–µ—Ä–≤–∏—Å–µ
4. ‚ùå `EmployeeRepository.findByIin()` - –º–µ—Ç–æ–¥ –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏
5. ‚ùå `AuthController` - –¥–æ–±–∞–≤–∏—Ç—å endpoint `send-otp-by-iin`
6. ‚ùå `WebMvcConfig.java` - rate limiting –¥–ª—è endpoint

### –†–µ—à–∏—Ç—å –≤–æ–ø—Ä–æ—Å —Å verify-otp

7. ‚ùå –í—ã–±—Ä–∞—Ç—å —Ä–µ—à–µ–Ω–∏–µ: –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å phone –∏–ª–∏ —Å–æ–∑–¥–∞—Ç—å `/verify-otp-by-iin`

### Testing

8. ‚ùå Unit tests –¥–ª—è `AuthService.sendOtpByIin()`
9. ‚ùå Integration tests –¥–ª—è endpoint
10. ‚ùå E2E —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–ª–Ω–æ–≥–æ —Ñ–ª–æ—É

---

## ‚è±Ô∏è Estimated

**Backend**: 3 —á–∞—Å–∞
- DTO –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è: 30 –º–∏–Ω
- Service –º–µ—Ç–æ–¥: 1 —á–∞—Å
- Controller endpoint: 30 –º–∏–Ω
- Rate limiting: 30 –º–∏–Ω
- –†–µ—à–µ–Ω–∏–µ —Å verify-otp: 30 –º–∏–Ω

**Testing**: 1.5 —á–∞—Å–∞

**–ò—Ç–æ–≥–æ**: 4.5 —á–∞—Å–∞ (–ø–æ–ª–¥–Ω—è)

---

## üìå –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: HIGH - —á–∞—Å—Ç–∞—è –ø—Ä–æ–±–ª–µ–º–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

**–†–∏—Å–∫–∏**:
- üî¥ **–í—ã—Å–æ–∫–∏–π**: –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å (–±—Ä—É—Ç—Ñ–æ—Ä—Å –ò–ò–ù) ‚Üí –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω rate limiting
- üü¢ **–ù–∏–∑–∫–∏–π**: –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π —Ä–∏—Å–∫ ‚Üí –ø—Ä–æ—Å—Ç–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

---

## üîó Related Tasks

- **Frontend**: –î–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å "–¢–µ–ª–µ—Ñ–æ–Ω/–ò–ò–ù" –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –ª–æ–≥–∏–Ω–∞
- **Mobile**: –î–æ–±–∞–≤–∏—Ç—å —ç–∫—Ä–∞–Ω –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –ø–æ –ò–ò–ù
- **Docs**: –û–±–Ω–æ–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é API
