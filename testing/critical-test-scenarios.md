# Детальные тестовые сценарии для критических путей Coube

## Критический путь №1: Полный цикл заявки от Заказчика

### Сценарий 1.1: Регистрация и создание организации

**Предусловия:** Пользователь не зарегистрирован в системе

**Шаги:**
1. Открыть страницу регистрации `/signup`
2. Заполнить форму регистрации:
   - Email
   - Телефон в формате +7 (xxx) xxx-xx-xx
   - ИИН
   - Пароль (минимум 8 символов)
3. Нажать "Зарегистрироваться"
4. Ввести код из SMS для подтверждения телефона
5. Дождаться автоматического перехода на страницу выбора организации
6. Создать новую организацию (указать БИН, название, адрес)
7. Выбрать роль "Заказчик"

**Ожидаемый результат:**
- Пользователь зарегистрирован
- Организация создана
- Пользователь перенаправлен в личный кабинет с ролью Заказчика

**Критерии приемки:**
- ✅ Регистрация проходит успешно
- ✅ OTP код приходит в течение 1 минуты
- ✅ Организация успешно создается
- ✅ Пользователь попадает на главную страницу

---

### Сценарий 1.2: Создание заявки на перевозку (все этапы)

**Предусловия:** Пользователь авторизован как Заказчик

**Шаг 1 - Основная информация:**
1. Перейти в раздел "Заявки" → "Создать заявку"
2. Заполнить основную информацию:
   - Тип перевозки: "Автомобильная"
   - Дата начала перевозки
   - Ожидаемая дата завершения
   - Контактное лицо
   - Телефон контактного лица
3. Нажать "Далее"

**Шаг 2 - Информация о грузе:**
1. Заполнить данные груза:
   - Тип груза: выбрать из справочника
   - Название груза
   - Вес (тонны)
   - Объем (м³)
   - Тип упаковки
   - Температурный режим (если требуется)
   - Необходимость страхования
2. Нажать "Далее"

**Шаг 3 - Маршрут (точки погрузки/разгрузки):**
1. Добавить точку погрузки:
   - Адрес (с автодополнением)
   - Дата и время прибытия
   - Контактное лицо
   - Телефон
   - Время на погрузку
2. Добавить точку разгрузки:
   - Аналогично точке погрузки
3. При необходимости добавить промежуточные точки
4. Нажать "Далее"

**Шаг 4 - Стоимость и условия:**
1. Указать стоимость перевозки
2. Выбрать валюту (KZT/USD/RUB)
3. Указать условия оплаты:
   - Аванс (процент)
   - Отсрочка платежа (дни)
4. Выбрать НДС (с НДС/без НДС)
5. Нажать "Далее"

**Шаг 5 - Выбор исполнителя:**
Вариант А - Выбор из списка:
1. Выбрать способ: "Выбрать исполнителя"
2. Выбрать одного или нескольких исполнителей из списка
3. Нажать "Создать заявку"

Вариант Б - По соглашению:
1. Выбрать способ: "По соглашению"
2. Выбрать активное соглашение
3. Нажать "Создать заявку"

**Ожидаемый результат:**
- Заявка создана со статусом "Новая"
- Заявка отображается в списке заявок Заказчика
- Исполнители получили уведомление о новой заявке
- Все данные сохранены корректно

**Критерии приемки:**
- ✅ Все шаги проходят без ошибок
- ✅ Можно вернуться на предыдущий шаг
- ✅ Данные сохраняются при переходе между шагами
- ✅ Валидация работает корректно (обязательные поля, форматы)
- ✅ Адреса корректно определяются через геокодер

---

### Сценарий 1.3: Работа с откликами исполнителей

**Предусловия:** Заявка создана, исполнители отправили отклики

**Шаги:**
1. Открыть заявку в списке
2. Перейти на вкладку "Отклики"
3. Просмотреть список откликов от исполнителей
4. Для каждого отклика видеть:
   - Название организации-исполнителя
   - Предложенная цена (если отличается)
   - Рейтинг исполнителя
   - Комментарий (если есть)

**Действие А - Принять цену исполнителя:**
1. Выбрать отклик
2. Нажать "Принять"
3. Подтвердить действие

**Действие Б - Принять встречное предложение:**
1. Выбрать отклик со встречным предложением
2. Просмотреть измененные условия
3. Нажать "Принять встречное предложение"
4. Подтвердить действие

**Действие В - Отклонить отклик:**
1. Выбрать отклик
2. Нажать "Отклонить"
3. Указать причину отклонения
4. Подтвердить

**Ожидаемый результат:**
- При принятии - статус заявки меняется на "Ожидание подписания"
- Исполнитель получает уведомление
- Формируется контракт
- Отклоненные отклики архивируются

**Критерии приемки:**
- ✅ Все отклики отображаются корректно
- ✅ Встречные предложения выделены визуально
- ✅ Действия выполняются без ошибок
- ✅ Уведомления отправляются

---

### Сценарий 1.4: Подписание контракта (Заказчик)

**Предусловия:** Отклик принят, контракт сформирован

**Шаги:**
1. Открыть заявку со статусом "Ожидание подписания"
2. Перейти на вкладку "Контракт"
3. Просмотреть условия контракта:
   - Реквизиты сторон
   - Предмет контракта
   - Стоимость
   - Сроки
   - Ответственность сторон
4. Скачать контракт в PDF (опционально)
5. Нажать "Подписать контракт"
6. Выбрать сертификат ЭЦП (Kalkan)
7. Ввести пароль от сертификата
8. Подтвердить подписание

**Ожидаемый результат:**
- Контракт подписан со стороны Заказчика
- Статус контракта: "Ожидает подписи Исполнителя"
- Исполнитель получил уведомление о необходимости подписания
- Подпись записана в базу данных

**Критерии приемки:**
- ✅ Контракт отображается корректно
- ✅ ЭЦП работает (Kalkan)
- ✅ Подпись проходит успешно
- ✅ Статус обновляется
- ✅ При ошибке подписания показывается понятное сообщение

---

### Сценарий 1.5: Отслеживание груза в процессе перевозки

**Предусловия:** Контракт подписан обеими сторонами, водитель начал выполнение

**Шаги:**
1. Открыть заявку со статусом "В пути"
2. Перейти на вкладку "Отслеживание"
3. Просмотреть карту с текущим местоположением транспорта
4. Просмотреть информацию о водителе:
   - ФИО
   - Телефон
   - Номер транспорта
5. Просмотреть статус выполнения:
   - Текущий этап (в пути к погрузке, погрузка, в пути к разгрузке и т.д.)
   - Прогресс-бар
   - Пройденное расстояние
6. Просмотреть историю перемещений
7. Позвонить водителю (опционально)

**Ожидаемый результат:**
- Карта отображает актуальное местоположение транспорта
- Информация о водителе корректна
- Статус обновляется в реальном времени
- История показывает все точки маршрута

**Критерии приемки:**
- ✅ Геолокация обновляется (не реже 1 раза в 5 минут)
- ✅ Карта работает корректно (Yandex Maps)
- ✅ Маршрут отображается на карте
- ✅ Можно позвонить водителю
- ✅ История перемещений сохраняется

---

### Сценарий 1.6: Завершение заявки и подтверждение выполнения

**Предусловия:** Водитель завершил разгрузку и закрыл заявку

**Шаги:**
1. Получить уведомление о завершении перевозки
2. Открыть заявку со статусом "Ожидает подтверждения"
3. Просмотреть информацию о выполнении:
   - Фактическое время начала/окончания
   - Фактически пройденное расстояние
   - Фото подтверждающих документов (CMR и т.д.)
4. Нажать "Подтвердить выполнение"
5. Оставить оценку и комментарий (опционально)
6. Подтвердить

**Ожидаемый результат:**
- Статус заявки меняется на "Завершена"
- Инициируется процесс формирования финансовых документов
- Исполнитель получает уведомление
- Оценка сохраняется в рейтинге исполнителя

**Критерии приемки:**
- ✅ Все данные о выполнении отображаются
- ✅ Фото загружаются и отображаются
- ✅ Подтверждение проходит успешно
- ✅ Статус обновляется
- ✅ Рейтинг исполнителя обновляется

---

## Критический путь №2: Водитель выполняет заявку (мобильное приложение)

### Сценарий 2.1: Авторизация и просмотр назначенной заявки

**Предусловия:** Водитель установил мобильное приложение

**Шаги:**
1. Открыть приложение
2. Ввести номер телефона
3. Ввести пароль
4. Нажать "Войти"
5. Разрешить доступ к геолокации (при первом входе)
6. Разрешить отправку push-уведомлений (при первом входе)
7. Выбрать организацию (если водитель работает в нескольких)
8. Перейти на экран "Мои заявки"
9. Открыть назначенную заявку

**Ожидаемый результат:**
- Водитель успешно авторизован
- Разрешения получены
- Заявка отображается с полной информацией:
  - Маршрут
  - Груз
  - Контакты
  - Сроки

**Критерии приемки:**
- ✅ Авторизация работает
- ✅ Разрешения запрашиваются корректно
- ✅ Заявка отображается со всеми данными
- ✅ Карта маршрута загружается

---

### Сценарий 2.2: Полный цикл выполнения заявки

**Предусловия:** Водитель авторизован, заявка назначена

#### Этап 1: Принятие заявки
**Шаги:**
1. Открыть заявку
2. Просмотреть детали
3. Свайпнуть кнопку "Принять заявку"

**Результат:** Статус = "Принята водителем"

---

#### Этап 2: Начало маршрута к месту погрузки
**Шаги:**
1. Свайпнуть кнопку "Начать маршрут"
2. Подтвердить действие

**Результат:** 
- Статус = "В пути к погрузке"
- Начинается отправка геолокации
- Заказчик видит движение транспорта

---

#### Этап 3: Прибытие на место погрузки
**Шаги:**
1. Приехать на место погрузки
2. Свайпнуть кнопку "Прибыл на погрузку"
3. Приложение проверяет, что водитель находится в радиусе 500м от точки
4. Подтвердить прибытие

**Результат:** 
- Статус = "На месте погрузки"
- Время прибытия зафиксировано
- Заказчик получил уведомление

**Критерии:**
- ✅ Геолокация проверяется (радиус 500м)
- ✅ Если водитель далеко - показать предупреждение
- ✅ Время фиксируется с точностью до минуты

---

#### Этап 4: Начало погрузки
**Шаги:**
1. Свайпнуть кнопку "Начать погрузку"
2. Подтвердить начало погрузки

**Результат:** 
- Статус = "Погрузка"
- Таймер погрузки запущен

---

#### Этап 5: Завершение погрузки
**Шаги:**
1. После завершения погрузки свайпнуть "Завершить погрузку"
2. Загрузить фото груза (обязательно)
3. Указать фактический вес (опционально, если отличается)
4. Добавить комментарий (опционально)
5. Подтвердить

**Результат:** 
- Статус = "Погружено"
- Фото сохранены
- Время погрузки зафиксировано

**Критерии:**
- ✅ Загружено минимум 1 фото
- ✅ Фото отображаются в заявке
- ✅ Данные сохранены

---

#### Этап 6: Отъезд к месту разгрузки
**Шаги:**
1. Свайпнуть кнопку "Отправиться к разгрузке"
2. Подтвердить отъезд

**Результат:** 
- Статус = "В пути к разгрузке"
- Геолокация отправляется
- Заказчик видит движение

---

#### Этап 7: Прибытие на место разгрузки
**Шаги:**
1. Приехать на место разгрузки
2. Свайпнуть кнопку "Прибыл на разгрузку"
3. Подтвердить (проверка геолокации)

**Результат:** 
- Статус = "На месте разгрузки"
- Время прибытия зафиксировано

---

#### Этап 8: Начало разгрузки
**Шаги:**
1. Свайпнуть кнопку "Начать разгрузку"
2. Подтвердить

**Результат:** 
- Статус = "Разгрузка"

---

#### Этап 9: Завершение разгрузки
**Шаги:**
1. Свайпнуть кнопку "Завершить разгрузку"
2. Загрузить фото разгруженного места (обязательно)
3. Получить подпись получателя (если требуется)
4. Загрузить фото CMR или накладной с подписью
5. Подтвердить

**Результат:** 
- Статус = "Разгружено"
- Все документы сохранены

---

#### Этап 10: Завершение заявки
**Шаги:**
1. Свайпнуть кнопку "Завершить заявку"
2. Подтвердить завершение
3. Оставить комментарий (опционально)

**Результат:** 
- Статус = "Ожидает подтверждения заказчика"
- Заказчик получил уведомление
- Исполнитель может формировать документы

**Критерии:**
- ✅ Все этапы пройдены последовательно
- ✅ Геолокация отправлялась на всех этапах движения
- ✅ Все фото загружены
- ✅ Время всех этапов зафиксировано
- ✅ Заказчик видел статусы в реальном времени

---

### Сценарий 2.3: Дополнительные функции водителя

#### Функция: SOS сигнал
**Шаги:**
1. В процессе выполнения заявки открыть меню
2. Нажать кнопку "SOS"
3. Подтвердить активацию
4. Указать причину (опционально)

**Результат:**
- SOS сигнал активирован
- Диспетчер получил экстренное уведомление
- Локация передается чаще (раз в 30 секунд)

**Деактивация:**
1. Нажать "Деактивировать SOS"
2. Подтвердить

---

#### Функция: Повреждение груза
**Шаги:**
1. В процессе выполнения нажать "Повреждение груза"
2. Сделать фото повреждений (минимум 2 фото)
3. Описать характер повреждения
4. Указать время обнаружения
5. Отправить

**Результат:**
- Инцидент зарегистрирован
- Заказчик и исполнитель получили уведомление
- Фото сохранены

---

#### Функция: Навигация
**Шаги:**
1. Открыть заявку
2. Нажать кнопку "Навигация"
3. Выбрать приложение карт (Yandex/Google/2GIS)

**Результат:**
- Открылось приложение навигации
- Адрес подставлен автоматически

---

## Критический путь №3: Финансовое закрытие

### Сценарий 3.1: Генерация и подписание АВР (Акт выполненных работ)

**Предусловия:** Заявка завершена и подтверждена заказчиком

**Шаги (Исполнитель):**
1. Перейти в раздел "Финансы" → "АВР"
2. Нажать "Создать АВР"
3. Выбрать завершенную заявку
4. Проверить автоматически заполненные данные:
   - Реквизиты сторон
   - Номер и дата контракта
   - Описание выполненных работ
   - Сумма
5. При необходимости внести корректировки
6. Нажать "Сформировать АВР"
7. Просмотреть сгенерированный документ
8. Нажать "Подписать ЭЦП"
9. Выбрать сертификат, ввести пароль
10. Подтвердить подписание

**Результат:**
- АВР сформирован и подписан исполнителем
- Заказчик получил уведомление о необходимости подписания
- Документ доступен для скачивания

**Шаги (Заказчик):**
1. Перейти в "Финансы" → "АВР"
2. Открыть АВР со статусом "Ожидает подписи"
3. Просмотреть документ
4. Нажать "Подписать"
5. Выбрать сертификат ЭЦП, ввести пароль
6. Подтвердить

**Результат:**
- АВР подписан обеими сторонами
- Статус = "Подписан"
- Можно формировать счет-фактуру

**Критерии приемки:**
- ✅ Данные заполняются автоматически из заявки
- ✅ ЭЦП работает с обеих сторон
- ✅ Документ можно скачать в PDF и Excel
- ✅ Подписи сохранены и проверяемы

---

### Сценарий 3.2: Генерация и работа со счетом-фактурой

**Предусловия:** АВР подписан обеими сторонами

**Шаги (Исполнитель):**
1. Перейти в "Финансы" → "Счета-фактуры"
2. Нажать "Создать счет-фактуру"
3. Выбрать подписанный АВР
4. Проверить данные:
   - Номер и дата
   - Реквизиты сторон
   - Перечень работ/услуг из АВР
   - Сумма с НДС/без НДС
5. Указать срок оплаты
6. Нажать "Сформировать"
7. Скачать в PDF
8. Отправить заказчику

**Результат:**
- Счет-фактура сформирован
- Заказчик получил уведомление и документ

**Шаги (Заказчик):**
1. Получить уведомление о счете-фактуре
2. Открыть счет-фактуру
3. Скачать документ
4. После оплаты изменить статус на "Оплачен"
5. Загрузить платежное поручение (опционально)

**Результат:**
- Статус счета = "Оплачен"
- Исполнитель получил уведомление об оплате
- Финансовый цикл заявки завершен

**Критерии приемки:**
- ✅ Счет-фактура формируется автоматически из АВР
- ✅ НДС рассчитывается корректно
- ✅ Документ соответствует законодательным требованиям РК
- ✅ Можно скачать в PDF и Excel
- ✅ Статусы отслеживаются

---

## Критический путь №4: Соглашения между организациями

### Сценарий 4.1: Создание рамочного соглашения

**Предусловия:** Две организации (заказчик и исполнитель) хотят работать по соглашению

**Шаги (Инициатор - Заказчик или Исполнитель):**
1. Перейти в "Соглашения"
2. Нажать "Создать соглашение"
3. Заполнить форму:
   - Название соглашения
   - Вторая сторона (выбрать организацию)
   - Срок действия (начало - окончание)
   - Условия:
     - Тарифы
     - Условия оплаты
     - Отсрочка платежа
     - Особые условия
4. Прикрепить документы (опционально)
5. Нажать "Создать"

**Результат:**
- Соглашение создано со статусом "Черновик"
- Вторая сторона получила уведомление

**Шаги (Вторая сторона):**
1. Получить уведомление
2. Открыть соглашение
3. Просмотреть условия
4. Вариант А: Принять и подписать ЭЦП
5. Вариант Б: Предложить изменения
6. Вариант В: Отклонить

**Результат (при принятии):**
- Соглашение активно
- Обе стороны могут создавать заявки по соглашению

**Критерии приемки:**
- ✅ Форма создания интуитивно понятна
- ✅ Можно прикрепить документы
- ✅ Подписание работает с обеих сторон
- ✅ Статусы отслеживаются

---

### Сценарий 4.2: Создание заявки по соглашению

**Предусловия:** Активное соглашение между организациями

**Шаги:**
1. Создать заявку (как в Сценарии 1.2)
2. На этапе "Выбор исполнителя" выбрать "По соглашению"
3. Выбрать нужное соглашение из списка активных
4. Система автоматически подставит условия из соглашения:
   - Тарифы
   - Условия оплаты
   - Отсрочка
5. При необходимости скорректировать специфичные для заявки параметры
6. Создать заявку

**Результат:**
- Заявка создана и автоматически назначена исполнителю по соглашению
- Не требуется процесс выбора исполнителя
- Условия зафиксированы согласно соглашению

**Критерии приемки:**
- ✅ Список показывает только активные соглашения
- ✅ Условия подставляются автоматически
- ✅ Можно скорректировать условия для конкретной заявки
- ✅ Процесс создания быстрее, чем обычный

---

## Дополнительные важные сценарии

### Сценарий 5: Отмена заявки

**Кейс А - Отмена до назначения водителя:**
1. Открыть заявку
2. Нажать "Отменить заявку"
3. Выбрать причину из списка
4. Добавить комментарий
5. Подтвердить

**Результат:**
- Заявка отменена
- Все участники получили уведомления
- Штрафы не применяются

**Кейс Б - Отмена после назначения водителя:**
1. Открыть заявку
2. Нажать "Отменить заявку"
3. Система показывает предупреждение о штрафах (если применимо)
4. Выбрать причину
5. Подтвердить с пониманием последствий

**Результат:**
- Заявка отменена
- Применены штрафные санкции (если по условиям контракта)
- Все участники уведомлены

---

### Сценарий 6: Встречное предложение от исполнителя

**Предусловия:** Исполнитель видит новую заявку

**Шаги:**
1. Открыть заявку
2. Нажать "Встречное предложение"
3. Изменить параметры:
   - Цена (увеличить/уменьшить)
   - Сроки (если требуется)
   - Условия оплаты
4. Добавить комментарий с обоснованием
5. Отправить

**Результат:**
- Заказчик получил встречное предложение
- В списке откликов предложение помечено особым образом

**Критерии:**
- ✅ Можно изменять допустимые параметры
- ✅ Изменения подсвечены для заказчика
- ✅ Комментарий видит заказчик

---

## Негативные сценарии (должны быть протестированы)

### Негативный сценарий 1: Попытка выполнить действия водителя без геолокации
- Отключить GPS на устройстве
- Попытаться отметить "Прибыл на погрузку"
- **Ожидается:** Ошибка с предложением включить GPS

### Негативный сценарий 2: Попытка подписать документ с недействительной ЭЦП
- Использовать истекший сертификат
- Попытаться подписать контракт
- **Ожидается:** Ошибка с описанием проблемы

### Негативный сценарий 3: Потеря интернет-соединения в процессе выполнения заявки
- Отключить интернет
- Попытаться выполнить действия (начать погрузку, загрузить фото)
- **Ожидается:** Данные сохраняются локально и синхронизируются при восстановлении связи

### Негативный сценарий 4: Завершение заявки без всех обязательных фото
- Попытаться завершить разгрузку без фото
- **Ожидается:** Валидация не дает завершить, требует загрузить фото

---

## Чек-лист для каждого критического сценария

После выполнения каждого сценария проверить:

✅ **Функциональность:**
- Все действия выполняются без ошибок
- Данные сохраняются корректно
- Статусы обновляются

✅ **Уведомления:**
- Все участники получили нужные уведомления
- Уведомления содержат корректную информацию

✅ **UI/UX:**
- Интерфейс понятен и интуитивен
- Нет проблем с производительностью
- Адаптивность на разных устройствах

✅ **Безопасность:**
- ЭЦП работает корректно
- Данные не доступны посторонним
- Сессия контролируется

✅ **Интеграции:**
- Карты работают (Yandex Maps)
- ЭЦП работает (Kalkan)
- SMS/Email доставляются

---

**Итого:** Данные сценарии покрывают критический путь пользователя от начала до конца и должны быть проверены в первую очередь перед каждым релизом.
